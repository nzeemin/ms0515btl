
157666:			; ??? SP

157672:			; Сохранённый PS
157674:			; Сохранённый PC; #172000
157676:			; ??? #000340

157702:
157704:			; ???
157706:			; Значение для системого регистра C - 177604

157712:			; ???
157714:			; Слово атрибутов при печати строки

157720:			; Значение для системного регистра A - 177600

157730:			; ???
157732:			; ???

157752:			; ??? #177777, #0

157760:			; ??? флаги
157762:			; ???
157764:			; Место для сохранения PS

157766:			; ??? вкл/выкл звука
157770:			; ???

157776:			; ???


160000: JMP    	164054			; Печать символа R0
160004: JMP    	175556			; Проверка клавиатуры есть ли символ
160010: JMP    	162652			; Загрузка с НГМД
160014: JMP    	162360			; Загрузка с НМЛ
160020: JMP    	167304
160024: JMP    	167316
;
; Начало процедуры холодного старта
160030: MOVB	#000213, @#177546	; ИРПР: регистр управления
160036: MOVB	#000202, @#177606	; Управляющее слово программируемого интерфейса
160044: MOVB	#000377, @#177540	; ???
160052: MOVB	#000007, @#177604	; Системный регистр C: звук выкл, среднее разрешение, белый бордюр
160060: MOVB	#000026, @#177506	; Таймер упр.слово
160066: MOVB	#000032, @#177500	; Таймер канал 0
160074: MOVB	#000126, @#177506	; Таймер упр.слово
160102: MOVB	#000032, @#177502	; Таймер канал 1
160110: CLR	R0
160112: MOV	#000002, R2
160116: MOV	#177442, R1		; Клавиатура регистр инструкций
160122: MOVB	R0, (R1)
160124: MOVB	R0, (R1)
160126: MOVB	R0, (R1)
160130: MOVB	#000100, (R1)
160134: MOVB	#000316, (R1)
160140: MOVB	#000047, (R1)
160144: MOV	#177702, R1		; Стык С2
160150: SOB	R2, 160122
160152: MOVB	#000000, 177600		; Системный регистр A
160160: JMP	172072
160164: NOP    	
160166: TST    	@#177770
160172: MOV    	(SP)+, @#157674
160176: MOV    	(SP)+, @#157676
160202: MOV	SP, @#157666
160206: MOV	#157674, SP
160212: MOV	@#157676, -(SP)
160216: MOV	@#157674, -(SP)
160222: CMP	R5, -(SP)
160224: MOV	R5, -(SP)
160226: MOV	R4, -(SP)
160230: MOV	R3, -(SP)
160232: MOV	R2, -(SP)
160234: MOV	R1, -(SP)
160236: MOV	R0, -(SP)
160240: TST	@#157752
160244: BEQ	160454
160246: RESET	
160250: BIC	#000177, @#157760
160256: CLR	@#157702
160262: CLR	@#157712
160266: MOV	#034000, @#157714
160274: BIS	#000007, @#157706	; Цвет бордюра белый
160302: TSTB	@#157760
160306: BMI	160320
160310: BIC	#000010, @#157706	; Выкл. высокое разрешение экрана
160316: BR	160326
160320: BIS    	#000010, @#157706
160326: MOVB	@#157706, @#177604	; Системный регистр C
160334: CLR	@#157704
160340: MOV	#000037, @#157720
160346: MOVB	@#157720, @#177600	; Системный регистр A
160354: CLRB	@#157722
160360: CLR	@#157724
160364: CLR	@#157726
160370: CLR	@#157710
160374: CLR	@#157762
160400: CLRB	@#157770
160404: MOV	#000012, 157732
160412: MTPS	#000340
; Очистка экрана и возврат в пульт
160416: MOV	#177233, R3		; строка 033 110 033 112 000
160422: CALL	160760			; Печать строки
160426: CALL	166350			; клавиатура??
160432: MOV	#110021, R3
160436: CALL	177040			; клавиатура??
160442: TST	@#157752
160446: BEQ	160454
160450: JMP	172532
160454: MOV	#157614, SP
160460: CLR	R1
160462: MOV	#177230, R3		; строка 015 012 000
160466: CALL	160760			; Печать строки
160472: MOV	@#157674, R3
160476: CALL	160662
; Точка входа: приглашение пульта '@' и ожидание ввода команды пульта
160502: MOV	#157614, SP
160506: MOV	#177224, R3		; строка 0D 0A 40 00
160512: CALL	160760			; Печать строки
160516: BIC	#004040, R1
160522: CLR	R5
160524: CALL	160616			; Ожидание ввода символа в режиме пульта
160530: BIT	#002000, R1		; введена цифра 0..7?
160534: BNE	160560			; не-цифра => команда введена, переходим
160536: BIS	#000040, R1
160542: ASL	R5
160544: ASL	R5
160546: ASL	R5
160550: ADD	R0, R5
160552: BR	160524			; продолжнаем ввод команды
; Команда пульта не найдена
160554: JMP	161046			; Вывести '?' и ждать следующей команды пульта
; Команда пульта введена - анализируем и выполняем
160560: MOV	#177777, R4		; начальное значение счётчика
160564: MOV	#177240, R3		; Таблица символов вводимых с пульта
160570: INC	R4			;   считаем номер команды в таблице
160572: CMPB	R0, (R3)+		;   эта команда?
160574: BEQ	160604			;   да => переходим к выполнению команды
160576: TSTB	(R3)			;   конец таблицы?
160600: BEQ	160554			;   да => команда пульта не найдена
160602: BR	160570			; продолжаем цикл
160604: ASL	R4			; умножаем на 2
160606: ADD	#177264, R4		; добавляем адрес таблицы
160612: MOV	(R4), R4		; берём адрес программы
160614: JMP	(R4)			; Переход к выполнению команды
;
160616: CALL	175546			; Ожидание символа с клавиатуры
160622: MOVB	R0, R3
160624: CALL	160776			; Печать символа
160630: BIC	#177607, R3
160634: CMP	#000060, R3		; цифра '0'..'7'?
160640: BNE	160654			; нет => переход
160642: BIC	#002000, R1		; признак цифры
160646: BIC	#177770, R0		; оставляем значение 0..7
160652: RETURN	
160654: BIS	#002000, R1		; ставим признак не-цифры
160660: RETURN	
; Подпрограмма
160662: MOV	@#157646, @#157634
160670: MOV	R3, @#157646
160674: MOV	#000006, R4
160700: CLR	R0
160702: ROL	R3
160704: ROL	R0
160706: ADD	#000060, R0
160712: CALL	160776			; Печать символа
160716: DEC	R4
160720: BEQ	160736
160722: CLR	R0
160724: ROL	R3
160726: ROL	R0
160730: ROL	R3
160732: ROL	R0
160734: BR	160702
160736: BIT	#004000, R1
160742: BNE	160754
160744: MOV	#000040, R0		; символ ' '
160750: CALL	160776			; Печать символа
160754: RETURN	
;
160756: BR	160502			; Возврат к приглашению пульта и вводу команды
;
; Подпрограмма: печать строки
160760: TSTB	(R3)			; конец строки?
160762: BEQ	160774			; да => на выход
160764: MOVB	(R3)+, R0		; берём символ
160766: CALL	160776			; Печать символа
160772: BR	160760			; продолжаем
160774: RETURN	
; Подпрограмма: печать символа
160776: CMPB	#000177, R0
161002: BNE	161040
161004: CMPB   	#000001, @#157702
161012: BEQ    	161044
161014: MOV    	#000010, R0
161020: CALL   	164054
161024: MOV    	#000040, R0
161030: CALL   	164054
161034: MOV    	#000010, R0
161040: CALL	164054			; Печать символа R0
161044: RETURN	
; Команда пульта не найдена - печать '?' и переход к вводу следующей команды
161046: MOVB	#000077, R0		; символ '?'
161052: CALL	164054			; Печать символа R0
161056: BR	160756			; Возврат к приглашению пульта и вводу команды
; Команда пульта '/' - открыть ячейку по текущему или заданному адресу
161060: BIS	#000020, R1
161064: BIT	#000040, R1
161070: BEQ	161100
161072: MOV    	R5, R2
161074: BIC    	#000500, R1
161100: MOV	(R2), R3
161102: CALL	160662
161106: JMP	160516
161112: MOV	#000012, R0
161116: CALL	160776			; Печать символа
161122: BIT	#000040, R1
161126: BEQ	161160
161130: BIT    	#000020, R1
161134: BEQ    	161160
161136: BIT    	#000100, R1
161142: BEQ    	161156
161144: BIC    	#177420, R5
161150: CLR    	(R2)
161152: BIS    	R5, (R2)
161154: BR     	161160
161156: MOV    	R5, (R2)
161160: BIC	#000020, R1
161164: MOV	#177226, R3		; Строка 100 000
161170: CALL	160760			; Печать строки
161174: BR	161410
161176: BIS    	#000200, R1
161202: BR     	161220
161204: BIC	#000200, R1
161210: MOV	#000012, R0
161214: CALL	160776			; Печать символа
161220: BIT	#000020, R1
161224: BEQ	161600			; => Ошибка в команде пульта
161226: MOV    	#000015, R0
161232: CALL   	160776			; Печать символа
161236: BIT    	#000040, R1
161242: BEQ    	161254
161244: BIT    	#000100, R1
161250: BNE    	161144
161252: MOV    	R5, (R2)
161254: BIT    	#000100, R1
161260: BNE    	161604
161262: BIT    	#000200, R1
161266: BEQ    	161330
161270: ADD    	#000002, R2
161274: BIT    	#000400, R1
161300: BEQ    	161354
161302: MOV    	R1, R0
161304: BIT    	#000200, R1
161310: BEQ    	161336
161312: CMP    	#157672, R2
161316: BNE    	161324
161320: MOV    	#157652, R2
161324: INC    	R0
161326: BR     	161412
161330: SUB    	#000002, R2
161334: BR     	161274
161336: CMP    	#157650, R2
161342: BNE    	161350
161344: MOV    	#157670, R2
161350: DEC    	R0
161352: BR     	161412
161354: BIS    	#004000, R1
161360: MOV    	R2, R3
161362: CALL   	160662
161366: MOV    	#000057, R0		; Символ '/'
161372: CALL   	160776			; Печать символа
161376: MOV    	(R2), R3
161400: BIC    	#004000, R1
161404: CALL   	160662
161410: BR	161562
161412: BIC    	#177770, R0
161416: BIC    	#000007, R1
161422: BIS    	R0, R1
161424: MOV    	#000122, R0		; Символ 'R'
161430: CALL   	160776			; Печать символа
161434: MOV    	R1, R0
161436: BIC    	#177770, R0		; Оставляем 0..7
161442: ADD    	#000060, R0		; +'0'
161446: CALL   	160776			; Печать символа
161452: MOV    	#000057, R0
161456: CALL   	160776			; Печать символа
161462: MOV    	(R2), R3
161464: CALL   	160662
161470: BR     	161562
161472: JMP    	160462
; Команда пульта 'R' - открыть регистр
161476: BIS	#000400, R1
161502: BIC	#000040, R1
161506: CALL	175546
161512: MOV	R0, R3
161514: CALL	160776			; Печать символа
161520: CMPB	#000123, R0
161524: BEQ	161566
161526: MOV	#157652, R2
161532: BIC	#177607, R3
161536: CMP	#000060, R3
161542: BNE	161600			; => Ошибка в команде пульта
161544: BIC	#177770, R0
161550: BIC	#000107, R1
161554: BIS	R0, R1
161556: ASL	R0
161560: ADD	R0, R2
161562: JMP	160516
161566: BIS    	#000100, R1
161572: MOV    	#157672, R2
161576: BR     	161410
;
161600: JMP	161046			; Команда пульта не найдена
;
161604: BIC    	#000020, R1
161610: JMP    	160502			; Возврат к приглашению пульта и вводу команды
161614: BIT    	#000020, R1
161620: BEQ    	161600			; => Ошибка в команде пульта
161622: BIC    	#000400, R1
161626: BIT    	#000040, R1
161632: BNE    	161642
161634: MOV    	@#157646, R2
161640: BR     	161644
161642: MOV    	R5, R2
161644: BIT    	#000100, R1
161650: BEQ    	161656
161652: MOV    	@#157634, R2
161656: MOV    	#177230, R3		; Строка 015 012 000
161662: CALL   	160760			; Печать строки
161666: BR     	161354
; Команда пульта '_' - открыть ячейку с относительным адресом
161670: BIT    	#000020, R1
161674: BEQ    	161600			; => Ошибка в команде пульта
161676: BIT    	#000500, R1
161702: BNE    	161604
161704: ADD    	#000002, R2
161710: BIT    	#000040, R1
161714: BEQ    	161722
161716: ADD    	R5, R2
161720: BR     	161644
161722: ADD    	@#157646, R2
161726: BR     	161644
; Команда пульта 'G' - пуск программы с указанного адреса
161730: RESET  	
161732: MOV    	R5, @#157674
161736: MOV    	R5, @#157670
161742: MOV    	#157652, SP
161746: MOV    	(SP)+, R0
161750: MOV    	(SP)+, R1
161752: MOV    	(SP)+, R2
161754: MOV    	(SP)+, R3
161756: MOV    	(SP)+, R4
161760: MOV    	(SP)+, R5
161762: MOV    	(SP), SP
161764: MTPS   	@#157672
161770: MOV    	@#157674, PC
;
; Команда пульта 'P' - продолжить выполнение программы
161774: MOV	#157652, SP
162000: MOV	(SP)+, R0
162002: MOV	(SP)+, R1
162004: MOV	(SP)+, R2
162006: MOV	(SP)+, R3
162010: MOV	(SP)+, R4
162012: MOV	(SP)+, R5
162014: MOV	(SP)+, SP
162016: MOV	@#157672, @#157676
162024: MOV	@#157670, @#157674
162032: CLR	@#157644
162036: MTPS	@#157672
162042: MOV	@#157674, PC
162046: ASR    	R5
162050: ASR    	R5
162052: ASR    	R5
162054: BIC    	#160000, R5
162060: JMP    	160524
;
; Команда пульта 'A' - управление атрибутами рабочей области экрана
162064: BIT	#000040, R1
162070: BEQ	161600			; => Ошибка в команде пульта
162072: TSTB	@#157760
162076: BMI	161600			; => Ошибка в команде пульта
162100: BIS    	#000200, @#157700
162106: MOV    	@#157700, @#177400
162114: MOV    	#001750, R0
162120: MOV    	#040001, R4
162124: MOVB   	R5, (R4)+
162126: INC    	R4
162130: MOVB   	R5, (R4)+
162132: INC    	R4
162134: MOVB   	R5, (R4)+
162136: INC    	R4
162140: MOVB   	R5, (R4)+
162142: INC    	R4
162144: MOVB   	R5, (R4)+
162146: INC    	R4
162150: MOVB   	R5, (R4)+
162152: INC    	R4
162154: MOVB   	R5, (R4)+
162156: INC    	R4
162160: MOVB   	R5, (R4)+
162162: INC    	R4
162164: SOB    	R0, 162124
162166: SWAB   	R5
162170: MOV    	R5, @#157714
162174: BIC    	#000200, @#157700
162202: MOV    	@#157700, @#177400
162210: JMP    	160502			; Возврат к приглашению пульта и вводу команды
;
; Команда пульта 'B' - управление цветом бордюра
162214: BIT	#000040, R1
162220: BEQ	162070
162222: BIC	#177770, R5
162226: BIC	#000007, @#157706
162234: BIS	R5, @#157706
162240: MOVB	@#157706, @#177604	; Системный регистр C
162246: JMP	160502			; Возврат к приглашению пульта и вводу команды
;
; Команда пульта 'D' - Загрузка с НГМД
162252: MOV	#162314, @#157730
162260: BIS	#100000, @#157720
162266: CALL	162652
162272: BLO	162300			; ошибка загрузки => переходим
162274: JMP	@#000000		; Запуск кода из загрузочного сектора
162300: MOV    	#177330, R3		; Строка "ОШИБКА ЗАГРУЗКИ"
162304: CALL   	160760			; Печать строки
162310: JMP    	160502			; Возврат к приглашению пульта и вводу команды
162314: HALT   	
162316: HALT   	
162320: HALT   	
162322: BR     	162324
;
; Команда 'V' с пульта - включение/выключение звука
162324: COM	@#157766		; переключение звука
162330: JMP	160502			; Возврат к приглашению пульта и вводу команды

; Загрузка с ленты - команда 'L' с пульта
162334: MOV	#124000, @#157714	; атрибуты при печати строки
162342: MOV	#177352, R3		; строка "  LOAD  "
162346: CALL	160760			; Печать строки
162352: MOV	#034000, @#157714	; атрибуты при печати строки
162360: BIC	#000004, @#157706	; Бордюр
162366: BIS	#000003, @#157706	;   фиолетовый
162374: MOVB	@#157706, @#177604	; Системный регистр C
162402: MOV	#177777, R3
162406: CALL	162504
162412: MOV    	R0, R4
162414: MOV    	R0, @#157704
162420: BIC    	#000002, @#157706
162426: MOV    	#000020, R3
162432: CALL   	162504
162436: MOV    	R0, R5
162440: ADD    	#000002, R5
162444: MOV    	#000020, R3
162450: CALL   	162504
162454: MOV    	R0, (R4)+
162456: CMP    	R4, R5
162460: BNE    	162444
162462: BIS    	#000002, @#157706
162470: MOV    	#177777, R3
162474: CALL   	162504
162500: MOV    	@#157704, PC
;
162504: CLR	R0
162506: CLR	R1
162510: TSTB	@#177602
162514: BPL	162520			; Бит 7 (НМЛ) = 0 => переход
162516: INC    	R1
162520: ASL	R0
162522: CLR	R2
162524: TSTB	@#177602
162530: BPL	162534			; Бит 7 (НМЛ) = 0 => переход
162532: INC    	R2
162534: CMP	R1, R2
162536: BEQ	162522
162540: BIS    	R2, R0
162542: MOV    	#000001, R1
162546: XOR    	R1, @#157706
162552: MOVB   	@#157706, @#177604	; Системный регистр C
162560: MOV    	#000406, R1		; величина задержки
162564: SOB    	R1, 162564		; задержка
162566: TSTB   	@#177602
162572: BPL    	162576			; Бит 7 (НМЛ) = 0 => переход
162574: INC    	R1
162576: TST    	R3
162600: BPL    	162636
162602: CMPB   	#000346, R0
162606: BNE    	162616
162610: CLR    	@#157710
162614: BR     	162632
162616: CMPB   	#000031, R0
162622: BNE    	162520
162624: MOV    	#177777, @#157710
162632: MOV    	#000021, R3
162636: DEC    	R3
162640: BNE    	162520
162642: MOV    	@#157710, R1
162646: XOR    	R1, R0
162650: RETURN 	
;
; Подпрограмма: загрузка с НГМД
162652: MFPS	@#157764		; Сохраняем PS
162656: MTPS	#000340
162662: MOV	R0, -(SP)
162664: MOV	R1, -(SP)
162666: MOV	R2, -(SP)
162670: MOV	R3, -(SP)
162672: MOV	R4, -(SP)
162674: MOV	R5, -(SP)
162676: MOV	#000012, @#157732
162704: MOV	#000012, @#164052	; Запись в ROM??
162712: MOV	@#157730, R3
162716: MOV	(R3)+, R5
162720: MOV	#000200, R4
162724: MOVB	(R3)+, R1
162726: BIC	#000013, @#157720
162734: MOVB	(R3), R0
162736: COM	R0
162740: BIC	#177775, R0
162744: ASL	R0
162746: ASL	R0
162750: BIS	R0, @#157720
162754: MOVB	(R3)+, R0
162756: BIC	#177776, R0
162762: BIS	R0, @#157720
162766: MOV	(R3)+, R0
162770: MOV	(R3)+, R2
162772: BPL	163002
162774: BIS    	#000240, R4
163000: NEG    	R2
163002: MOV	R4, @#157750
163006: ASL	R2
163010: MOV	#173371, R4
163014: CMP	#002400, R5
163020: BHI	163026
163022: ADD    	#175400, R5
163026: ROL	R5
163030: INCB	R4
163032: BLE	163014
163034: MOVB	R5, R1
163036: ADD	R4, R5
163040: MOV	R1, R4
163042: ASL	R1
163044: SUB	#000012, R1
163050: BGT	163044
163052: MOV	R1, @#157744
163056: MOV	R0, @#157734
163062: MOV	R5, @#157736
163066: MOV	R2, @#157740
163072: MOVB	@#157720, @#177600	; Системный регистр A
163100: BIT	#000004, @#157720
163106: BEQ	163140
163110: BIC	#000004, @#157720	; бит 2 - двигатель НГМД
163116: MOV	@#157720, @#177600	; Системный регистр A
163124: MOV	#000003, R1
163130: MOV	#177777, R3
163134: SOB	R3, 163134
163136: SOB	R1, 163130
163140: MOV	#000012, @#157742
163146: MOV	#000300, R0
163152: CALL	163720
163156: BITB	#000020, (R4)
163162: BEQ	163226
163164: DEC    	@#157742
163170: BNE    	163176
163172: JMP    	163762
163176: MOV    	#000001, R0
163202: CALL   	163720
163206: MOV    	#020000, R1
163212: SOB    	R1, 163212
163214: NOP    	
163216: NOP    	
163220: NOP    	
163222: NOP    	
163224: BR     	163146
163226: MOVB	@#177644, @#177642	; Регистр сектора -> регистр дорожки
163234: MOVB	@#157737, R2
163240: BGT	163272
163242: SUB	#177772, R2
163246: BGT	163256
163250: ADD	#000004, R2
163254: SEC	
163256: ROL	R2
163260: ADD	@#157744, R2
163264: BGT	163272
163266: ADD	#000012, R2
163272: MOV	@#157736, R3
163276: CMPB	R3, #000120
163302: BNE	163306
163304: CLR    	R3
163306: MOV	#177640, R4
163312: CMPB	R3, 000002(R4)
163316: BEQ	163352
163320: MOVB   	R3, 000006(R4)
163324: MOV    	#000035, R0
163330: CALL   	163720
163334: MOV    	#020000, R1
163340: SOB    	R1, 163340
163342: BITB   	#000020, (R4)
163346: BEQ    	163352
163350: BR     	163146
163352: MOV	#000100, @#157732
163360: MOV	#000001, R3
163364: NOP	
163366: NOP	
163370: MOV	@#157734, R5
163374: MOV	@#157750, R0
163400: MOVB	R2, 000004(R4)
163404: MOV	157740, R2
163410: MOV	#000002, R1
163414: BITB	#000200, (R4)
163420: BNE	163414
163422: MOVB	R0, (R4)
163424: BITB	R3, (R4)
163426: BEQ	163424
163430: SOB	R3, 163430
163432: BITB	#000040, R0
163436: BNE	163504
163440: BITB	R1, (R4)
163442: BNE	163454
163444: BITB	#000001, (R4)
163450: BNE	163440
163452: BR     	163560
163454: MOVB	000006(R4), (R5)+
163460: SOB	R2, 163440
163462: BITB	R1, (R4)
163464: BNE	163476
163466: BITB	#000001, (R4)
163472: BNE	163462
163474: BR	163560
163476: MOVB   	000006(R4), R5
163502: BR     	163462
163504: BITB   	R1, (R4)
163506: BNE    	163520
163510: BITB   	#000001, (R4)
163514: BNE    	163504
163516: BR     	163552
163520: MOVB   	(R5)+, 000006(R4)
163524: SOB    	R2, 163504
163526: BITB   	R1, (R4)
163530: BNE    	163542
163532: BITB   	#000001, (R4)
163536: BNE    	163526
163540: BR     	163552
163542: MOVB   	#000000, 000006(R4)
163550: BR     	163526
163552: MOV    	#000575, R1
163556: SOB    	R1, 163556
163560: TSTB	(R4)
163562: BEQ	163634
163564: DEC    	@#157732
163570: BNE    	163576
163572: JMP    	163762
163576: BITB   	#000100, (R4)
163602: BEQ    	163610
163604: JMP    	163762
163610: BITB   	#000020, (R4)
163614: BEQ    	163622
163616: JMP    	163164
163622: BITB   	#000014, (R4)
163626: BNE    	163360
163630: JMP    	163762
163634: MOV	#000100, @#157732
163642: INCB	@#157737
163646: BNE	163674
163650: ADD    	#173001, @#157736
163656: ADD    	#000002, @#157744
163664: BLE    	163674
163666: SUB    	#000012, @#157744
163674: MOV	#001000, R2
163700: ADD	R2, @#157734
163704: SUB	R2, @#157740
163710: BHI	163714
163712: BR	163752
163714: JMP    	163234
163720: MOV	#177640, R4
163724: BITB	#000200, (R4)
163730: BNE	163724
163732: MOVB	R0, (R4)
163734: BITB	#000001, (R4)
163740: BEQ	163734
163742: BITB	#000001, (R4)
163746: BNE	163742
163750: RETURN	
163752: BIC	#000001, @#157764
163760: BR	163770
163762: BIS    	#000001, @#157764
163770: MOV	(SP)+, R5
163772: MOV	(SP)+, R4
163774: MOV	(SP)+, R3
163776: MOV	(SP)+, R2
164000: MOV	(SP)+, R1
164002: MOV	(SP)+, R0
164004: TST	@#157720
164010: BPL	164022
164012: BIS	#040000, @#157720
164020: BR	164044
164022: BIC    	#040000, @#157720
164030: BIS    	#000017, @#157720
164036: MOVB   	@#157720, @#177600
164044: MTPS	@#157764
164050: RETURN	
164052: HALT   				; Сюда пытаемся записать см. 162704
;
; Подпрограмма: печать символа R0
164054: MFPS	@#157764		; Сохраняем PS
164060: MTPS	#000340
164064: MOV	R0, -(SP)
164066: MOV	R1, -(SP)
164070: MOV	R2, -(SP)
164072: MOV	R3, -(SP)
164074: MOV	R4, -(SP)
164076: MOV	R5, -(SP)
164100: BIC	#177400, R0		; Оставляем младший байт
164104: CALL	165504
164110: BIS	#000200, @#157700
164116: MOV	@#157700, @#177400	; Дисп. памяти
164124: ADD	#000740, R2
164130: TSTB	@#157760
164134: BPL	164160
164136: ADD	#000120, R2
164142: BICB	#000377, (R2)
164146: ADD	#000120, R2
164152: BICB	#000377, (R2)
164156: BR	164174
164160: BIC	#100000, (R2)
164164: ADD	#000120, R2
164170: BIC	#100000, (R2)
164174: BIC	#000200, @#157700
164202: MOV	@#157700, @#177400	; Дисп. памяти
164210: MOV	@#157760, R1
164214: BIC	#177774, R1
164220: BEQ	164416
164222: CMP	#000001, R1
164226: BNE	164250
164230: BICB	#000001, @#157760
164236: MOV	#164552, R4
164242: MOV	#164572, R5
164246: BR	164464
164250: CMP	#000002, R1
164254: BNE	164326
164256: SUB	#000040, R0
164262: BMI	164316
164264: TST	@#157762
164270: BNE	164302
164272: CMPB	#000030, R0
164276: BGE	164312
164300: BR     	164316
164302: CMPB   	#000027, R0
164306: BGE    	164312
164310: BR     	164316
164312: MOVB	R0, @#157703
164316: BIS	#000001, @#157760
164324: BR	164504
164326: CMP	#000003, R1
164332: BNE	164406
164334: SUB	#000040, R0
164340: BMI	164400
164342: TSTB	@#157760
164346: BMI	164364
164350: CMPB	#000047, R0
164354: BGE	164402
164356: MOV    	#000047, R0
164362: BR     	164402
164364: CMPB   	#000117, R0
164370: BGE    	164402
164372: MOV    	#000117, R0
164376: BR     	164402
164400: CLR    	R0
164402: MOVB	R0, @#157702
164406: BIC	#000003, @#157760
164414: BR	164504
164416: CMPB	R0, #000040
164422: BLO	164430
164424: JMP	164632
164430: TSTB	@#157723
164434: BNE	164454
164436: CMPB	#000016, R0
164442: BEQ	164452
164444: CMPB	#000017, R0
164450: BNE	164454
164452: BR     	164504
164454: MOV	#164510, R4
164460: MOV	#164524, R5
164464: CMPB	R0, (R4)+
164466: BEQ	164500
164470: TSTB	(R4)
164472: BEQ	164504
164474: TST	(R5)+
164476: BR	164464
164500: CALL	@000000(R5)
164504: JMP	165142
164510: .BYTE	
164524: .BYTE	

164632: BIS	#000200, @#157700
164640: MOV	@#157700, @#177400	; Дисп. памяти
164646: TSTB	@#157723
164652: BNE	164716
164654: CMPB	#000377, R0
164660: BEQ	164712
164662: CMPB	R0, #000200
164666: BLO	164722
164670: SUB	#000300, R0
164674: BLO	164712
164676: ASL	R0
164700: ASL	R0
164702: ASL	R0
164704: ADD	#170736, R0
164710: BR	164770
164712: JMP    	165142
164716: BIC    	#177600, R0
164722: SUB	#000040, R0
164726: ASL	R0
164730: ASL	R0
164732: ASL	R0
164734: BIT	#000004, @#157760
164742: BEQ	164764
164744: CMP    	R0, #000400
164750: BLO    	164764
164752: SUB    	#000400, R0
164756: ADD    	#170736, R0
164762: BR     	164770
164764: ADD	#167336, R0
164770: MOV	@#157712, R4
164774: MOV	#000010, R2
165000: TSTB	@#157760
165004: BPL	165020
165006: MOVB	(R0)+, (R4)
165010: ADD	#000120, R4
165014: SOB	R2, 165006
165016: BR	165042
165020: MOVB	(R0)+, R1
165022: BIC	#177400, R1
165026: BIS	@#157714, R1
165032: MOV	R1, (R4)
165034: ADD	#000120, R4
165040: SOB	R2, 165020
165042: BIC	#000200, @#157700
165050: MOV	@#157700, @#177400	; Дисп. памяти
165056: CALL	166066
165062: TST	@#157702
165066: BNE	165142
165070: MOVB   	#000030, @#157703
165076: TST    	@#157762
165102: BEQ    	165110
165104: DECB   	@#157703
165110: CMPB	#000030, @#157703
165116: BEQ	165324
165120: TST	@#157762
165124: BEQ	165136
165126: CMPB   	#000027, @#157703
165134: BEQ    	165324
165136: CALL	166130
165142: CALL	165504
165146: ADD	#000740, R2
165152: BIS	#000200, @#157700
165160: MOV	@#157700, @#177400	; Дисп. памяти
165166: TSTB	@#157760
165172: BPL	165216
165174: ADD	#000120, R2
165200: BISB	#000377, (R2)
165204: ADD	#000120, R2
165210: BISB	#000377, (R2)
165214: BR	165232
165216: BIS	#100000, (R2)
165222: ADD	#000120, R2
165226: BIS	#100000, (R2)
165232: BIC	#000200, @#157700
165240: MOV	@#157700, @#177400	; Дисп. памяти
165246: BITB	#000004, @#157760
165254: BNE	165266
165256: BIS	#000020, @#157720	; Светодиод 1
165264: BR	165274
165266: BIC    	#000020, @#157720
165274: MOVB	@#157720, @#177600	; Системный регистр A
165302: MOV	(SP)+, R5
165304: MOV	(SP)+, R4
165306: MOV	(SP)+, R3
165310: MOV	(SP)+, R2
165312: MOV	(SP)+, R1
165314: MOV	(SP)+, R0
165316: MTPS	@#157764		; Восстанавливаем PS
165322: RETURN	
;
165324: BIS	#000200, @#157700
165332: MOV	@#157700, @#177400
165340: MOV	#040000, R4
165344: MOV	#041200, R5
165350: MOV	#001700, R3
165354: TST	@#157762
165360: BEQ	165366
165362: SUB    	#000050, R3
165366: MOV	(R5)+, (R4)+
165370: MOV	(R5)+, (R4)+
165372: MOV	(R5)+, (R4)+
165374: MOV	(R5)+, (R4)+
165376: MOV	(R5)+, (R4)+
165400: MOV	(R5)+, (R4)+
165402: MOV	(R5)+, (R4)+
165404: MOV	(R5)+, (R4)+
165406: SOB	R3, 165366
165410: MOV	@#157714, R5
165414: MOV	#000050, R3
165420: TSTB	@#157760
165424: BPL	165442
165426: CLR	R5
165430: TST	@#157762
165434: BEQ	165442
165436: ADD    	#000050, R3
165442: MOV	R5, (R4)+
165444: MOV	R5, (R4)+
165446: MOV	R5, (R4)+
165450: MOV	R5, (R4)+
165452: MOV	R5, (R4)+
165454: MOV	R5, (R4)+
165456: MOV	R5, (R4)+
165460: MOV	R5, (R4)+
165462: SOB	R3, 165442
165464: BIC	#000200, @#157700
165472: MOV	@#157700, @#177400
165500: JMP	165142
;
165504: MOV	@#157702, R2
165510: MOV	R2, R3
165512: BIC	#000377, R3
165516: ASL	R2
165520: ASR	R3
165522: TSTB	@#157760
165526: BPL	165532
165530: RORB	R2
165532: ADD	R3, R2
165534: ADD	#040000, R2
165540: MOV	R2, @#157712
165544: RETURN	
165546: MOV	@#157712, R4
165552: MOVB	@#157702, R3
165556: MOV	@#157714, R1
165562: TSTB	@#157760
165566: BMI	165654
165570: MOV	#000050, R0
165574: SUB	R3, R0
165576: MOV	R4, -(SP)
165600: MOV	#000010, R2
165604: BIS	#000200, @#157700
165612: MOV	@#157700, @#177400	; Дисп. памяти
165620: MOV	R1, (R4)
165622: ADD	#000120, R4
165626: SOB	R2, 165620
165630: BIC	#000200, @#157700
165636: MOV	@#157700, 177400	; Дисп. памяти
165644: MOV	(SP)+, R4
165646: TST	(R4)+
165650: SOB	R0, 165576
165652: RETURN	
165654: MOV	#000120, R0
165660: SUB	R3, R0
165662: MOV	R4, -(SP)
165664: MOV	#000010, R2
165670: BIS	#000200, @#157700
165676: MOV	@#157700, @#177400	; Дисп. памяти
165704: MOVB	R1, (R4)
165706: ADD	#000120, R4
165712: SOB	R2, 165704
165714: BIC	#000200, @#157700
165722: MOV	@#157700, @#177400	; Дисп. памяти
165730: MOV	(SP)+, R4
165732: INC	R4
165734: SOB	R0, 165662
165736: RETURN	
165740: CALL	165546
165744: MOV	@#157714, R5
165750: ADD	#001060, R4
165754: MOV	R4, R3
165756: MOV	#100000, R0
165762: SUB	R3, R0
165764: ASR	R0
165766: ASR	R0
165770: ASR	R0
165772: ASR	R0
165774: TSTB	@#157760
166000: BPL	166004
166002: CLR	R5
166004: BIS	#000200, @#157700
166012: MOV	@#157700, @#177400	; Дисп. памяти
166020: MOV	R5, (R4)+
166022: MOV	R5, (R4)+
166024: MOV	R5, (R4)+
166026: MOV	R5, (R4)+
166030: MOV	R5, (R4)+
166032: MOV	R5, (R4)+
166034: MOV	R5, (R4)+
166036: MOV	R5, (R4)+
166040: SOB	R0, 166004
166042: BIC	#000200, @#157700
166050: MOV	@#157700, @#177400	; Дисп. памяти
166056: RETURN	
166060: CLR	@#157702
166064: RETURN	
;
166066: INCB	@#157702
166072: TSTB	@#157760
166076: BPL	166112
166100: CMPB	#000120, @#157702
166106: BEQ	166124
166110: RETURN	
166112: CMPB	#000050, @#157702
166120: BEQ	166124
166122: RETURN	
166124: CLRB   	@#157702
166130: INCB	@#157703
166134: CMPB	#000031, @#157703
166142: BEQ	166164
166144: TST	@#157762
166150: BEQ	166162
166152: CMPB   	#000030, @#157703
166160: BEQ    	166164
166162: RETURN	
166164: CLRB   	@#157703
166170: RETURN 	
166172: INCB   	@#157702
166176: TSTB   	@#157760
166202: BPL    	166216
166204: CMPB   	#000120, @#157702
166212: BEQ    	166230
166214: RETURN 	
166216: CMPB   	#000050, @#157702
166224: BEQ    	166230
166226: RETURN 	
166230: DECB   	@#157702
166234: RETURN 	
166236: INCB   	@#157703
166242: CMPB   	#000031, @#157703
166250: BEQ    	166272
166252: TST    	@#157762
166256: BEQ    	166270
166260: CMPB   	#000030, @#157703
166266: BEQ    	166272
166270: RETURN 	
166272: DECB   	@#157703
166276: RETURN 	
166300: DECB   	@#157702
166304: BMI    	166310
166306: RETURN 	
166310: CLRB   	@#157702
166314: RETURN 	
166316: DECB   	@#157703
166322: BMI    	166326
166324: RETURN 	
166326: CLRB   	@#157703
166332: RETURN 	
166334: CLRB	@#157702
166340: RETURN	
166342: TST	(SP)+
166344: JMP	165110
;
166350: BIT	#000001, @#177442	; Клавиатура
166356: BEQ	166350
166360: MOV	#000247, @#177460	; Клавиатура
166366: RETURN	
166370: BIS	#000001, @#157760
166376: RETURN	
166400: BIS    	#000004, @#157760
166406: RETURN 	
166410: BIC    	#000004, @#157760
166416: RETURN 	
166420: BIS	#000002, @#157760
166426: RETURN	
;
166430: MOVB   	@#157702, R1
166434: BIC    	#177400, R1
166440: MOV    	#166514, R2
166444: CMPB   	(R2)+, R1
166446: BLOS   	166444
166450: MOVB   	-(R2), R1
166452: TSTB   	@#157760
166456: BMI    	166474
166460: CMPB   	R1, #000050
166464: BLO    	166506
166466: MOVB   	#000040, R1
166472: BR     	166506
166474: CMPB   	R1, #000120
166500: BLO    	166506
166502: MOVB   	#000117, R1
166506: MOVB   	R1, @#157702
166512: RETURN 	

167304: BIC    	R0, R1
167306: MOV    	R1, @#177400
167312: MOV    	R3, (R2)+
167314: BR     	167326
;
167316: BIC    	R0, R1
167320: MOV    	R1, @#177400
167324: MOV    	(R2)+, R3
167326: BIS    	R0, R1
167330: MOV    	R1, @#177400
167334: RETURN 	

; Старт процессора
172000: JMP	160030
; Рестарт процессора
172004: JMP    	160164

; Подпрограмма: найти выставленный бит в R1 и получить адрес 2-символьной строки для кол-ва Кбайт
172010: BIS	#000200, R1
172014: CLR	R3
172016: INC	R3
172020: ROR	R1
172022: BHIS	172016
172024: ASL	R3
172026: ADD	#<175232-2>, R3		; Адрес таблицы 2-символьных строк
172032: RETURN	
;
172034: MFPS	R0
172036: BIC	#177760, R0
172042: ADD	R0, @#156600
172046: RETURN	
; Подпрограмма с вызовом по R1: печать строки
172050: MOV	(R1)+, @#157714		; слово атрибутов при печати символов
172054: MOV	(R1)+, R3		; начало строки
172056: BR	172064
172060: CALL	@#164054		; Печать символа R0
172064: MOVB	(R3)+, R0
172066: BNE	172060
172070: RTS	R1
;
172072: MOV	#002377, @#177400	; Дисп. памяти
172100: MOV	#043777, R0
172104: MOV	#040000, R4
172110: MOV	#004000, R1
172114: MOV	R0, (R4)+
172116: MOV	R0, (R4)+
172120: MOV	R0, (R4)+
172122: MOV	R0, (R4)+
172124: SOB	R1, 172114
172126: MOV	#000002, R2
172132: MOV	#000177, @#177400	; Дисп. памяти
172140: CLR	R4
172142: MOV	#016000, R3
172146: CLR	(R4)+
172150: CLR	(R4)+
172152: CLR	(R4)+
172154: CLR	(R4)+
172156: SOB	R3, 172146
172160: CLR	@#177400		; Дисп. памяти
172164: SOB	R2, 172140
172166: CLR	R0
172170: MOV	#000002, R1
172174: MOV	#000177, @#177400	; Дисп. памяти
172202: MOV	#000002, R2
172206: CLR	SP
172210: MOV	#067777, R3
172214: CMP	R0, (SP)
172216: BEQ	172254
172220: MOV    	SP, R4
172222: ROL    	R4
172224: ROL    	R4
172226: ROL    	R4
172230: ROL    	R4
172232: BIC    	#177770, R4
172236: INC    	R4
172240: CLR    	R5
172242: SEC    	
172244: ROL    	R5
172246: SOB    	R4, 172244
172250: BIS    	R5, @#157776
172254: COM	(SP)+
172256: SOB	R3, 172214
172260: CLR	@#177400		; Дисп. памяти
172264: SOB	R2, 172206
172266: COM	R0
172270: SOB	R1, 172174
172272: MOV	#000002, R1
172276: MOV	#000177, @#177400	; Дисп. памяти
172304: MOV	#000002, R2
172310: MOV	#157776, SP
172314: MOV	#067777, R3
172320: CMP	R0, -(SP)
172322: BEQ	172360
172324: MOV    	SP, R4
172326: ROL    	R4
172330: ROL    	R4
172332: ROL    	R4
172334: ROL    	R4
172336: BIC    	#177770, R4
172342: INC    	R4
172344: CLR    	R5
172346: SEC    	
172350: ROL    	R5
172352: SOB    	R4, 172350
172354: BIS    	R5, @#157776
172360: COM	(SP)
172362: SOB	R3, 172320
172364: CLR	@#177400		; Дисп. памяти
172370: SOB	R2, 172310
172372: COM	R0
172374: SOB	R1, 172276
172376: MOV	#002377, @#177400	; Дисп. памяти
172404: CLR	@#157774
172410: MOV	#043777, R0
172414: MOV	#000002, R2
172420: MOV	#040000, R4
172424: MOV	#020000, R1
172430: CMP	R0, (R4)
172432: BEQ	172440
172434: BIS    	R4, @#157774
172440: MOV	#034000, (R4)+
172444: SOB	R1, 172430
172446: MOV	#034000, R0
172452: SOB	R2, 172420
172454: MOV	#002177, @#157700
172462: MOVB	@#157700, @#177400	; Дисп. памяти
172470: CLR	@#157760
172474: CLR	@#157766		; выкл. звук?
172500: MOV	#172000, @#157674
172506: MOV	#000340, @#157676
172514: MOV	#157614, SP
172520: MOV	#177777, @#157752
172526: JMP	160202
;
172532: JSR	R1, 172050		; Печать строки пробелов над "Электроника"
	.WORD	070000, 174660		;   на жёлтом фоне
172542: JSR	R1, 172050		; Печать строки "Электроника"
	.WORD	060400, 174714		;   на зелёном фоне
172552: JSR	R1, 172050		; Печать строки пробелов под "Электроника"
	.WORD	070000, 174750		;   на жёлтом фоне
172562: JSR	R1, 172050		; Печать строки "Тест  О З У "
	.WORD	035000, 175004		;   атрибуты, адрес строки
172572: JSR	R1, 172050		; Печать строки "Без дефектов:"
	.WORD	034000, 175025		;   атрибуты, адрес строки
172602: JSR	R1, 172054		; Печать строки "Основное       "
	.WORD	175047			;   адрес строки
172610: MOV	@#157776, R1		; Берём результат теста основной памяти
172614: CALL	172010			; По битам в R1 получить 2-симв. строку
172620: MOV	#071000, @#157714	; атрибуты при печати символов
172626: MOVB	(R3)+, R0		; взять первый символ
172630: CALL	164054			; Печать символа R0
172634: MOVB	(R3), R0		; взять второй символ
172636: CALL	164054			; Печать символа R0
172642: JSR	R1, 172050		; Печать строки "  Кбайт"
	.WORD	034000, 175073		;   атрибуты, адрес строки
172652: JSR	R1, 172050		; Печать строки "Дополнительное "
	.WORD	034000, 175103		;   атрибуты, адрес строки
172662: MOV	#002077, @#177400	; Дисп. памяти - вкл. доп.память
172670: MOV	@#157776, R1		; берём из доп.памяти
172674: MOV	#002177, @#177400	; Дисп. памяти - выкл. доп.память
172702: CALL	172010			; По битам в R1 получить 2-симв. строку
172706: MOV	#071000, @#157714	; атрибуты при печати строки
172714: MOVB	(R3)+, R0		; взять первый символ
172716: CALL	164054			; Печать символа R0
172722: MOVB	(R3), R0		; взять второй символ
172724: CALL	164054			; Печать символа R0
172730: JSR	R1, 172050		; Печать строки "  Кбайт"
	.WORD	034000, 175073		;   атрибуты, адрес строки
172740: JSR	R1, 172054		; Печать строки
	.WORD	175127
172746: TST	@#157774
172752: BEQ	172762
172754: MOV    	#175232, R3
172760: BR     	172766
172762: MOV	#175236, R3		; адрес 2-симв.строки "16"
172766: MOV	#071000, @#157714	; атрибуты при печати символов
172774: MOVB	(R3)+, R0		; взять первый символ
172776: CALL	164054			; Печать символа
173002: MOVB	(R3), R0		; взять второй символ
173004: CALL	164054			; Печать символа
173010: JSR	R1, 172050		; Печать строки "  Кбайт"
	.WORD	034000, 175073		;   атрибуты, адрес строки
173020: JSR	R1, 172050		; Печать строки "Тест  П З У"
	.WORD	035000, 175153		;   атрибуты, адрес строки
173030: MOV	#160000, R1
173034: CLR	R0
173036: ADD	(R1)+, R0
173040: CMP	#177400, R1
173044: BNE	173036
173046: TST	R0
173050: BR	173062
173052: JSR    	R1, 172050
	.WORD
173062: JSR	R1, 172050		; Печать строки
	.WORD	
173072: CLR	R5
173074: CLR	@#156600
173100: MOV	#156600, R4
173104: MFPS	R0
173106: BIC	#000017, R0
173112: MTPS	R0
173114: CCC	
173116: MOV	#156606, @#156606
173124: CALL	172034
173130: BIC	174656, R1
173134: CALL	172034
173140: ADD	@156606(R1), R1
173144: CALL	172034
173150: BIS	#000001, (R1)+
173154: CALL	172034
173160: SUB	#156606, -(R1)
173164: CALL	172034
173170: SUB	#000001, (R1)
173174: BIT	174656, (R1)
173200: CALL	172034
173204: MOV	#156606, 000002(R1)
173212: CALL	172034
173216: ADD	#000002, R1
173222: MOV	(R1), @(R1)+
173224: CALL	172034
173230: MOV	@-(R1), R1
173232: CALL	172034
173236: CMP	#156606, R1
173242: BNE	173260
173244: CALL	172034
173250: ADD	R1, (R4)
173252: CMP	#156702, (R4)
173256: BEQ	173272
173260: JSR    	R1, 172050
	.WORD	171000, 175252
173270: BR     	173270
173272: CLR	(R1)
173274: CALL	172034
173300: COM	(R1)
173302: CALL	172034
173306: INC	(R1)
173310: CALL	172034
173314: TST	(R1)
173316: CALL	172034
173322: DEC	(R1)
173324: CALL	172034
173330: NEG	(R1)
173332: CALL	172034
173336: ROR	(R1)
173340: MOV	(R1), R2
173342: ADC	(R1)
173344: CALL	172034
173350: ADD	R2, (R4)
173352: ROL	(R1)
173354: CALL	172034
173360: ASR	(R1)
173362: MOV	(R1), R2
173364: SBC	(R1)
173366: CALL	172034
173372: ADD	R2, (R4)
173374: ASL	(R1)
173376: CALL	172034
173402: SWAB	(R1)
173404: CALL	172034
173410: ADD	(R1), (R4)
173412: CMP	#157745, (R4)
173416: BEQ	173422
173420: BR     	173260
173422: SEC	
173424: BHIS	173420
173426: CLC	
173430: BLO	173420
173432: CLZ	
173434: BLOS	173420
173436: SEZ	
173440: BHI	173420
173442: CLV	
173444: BVS	173420
173446: SEV	
173450: BVC	173420
173452: CLN	
173454: BMI	173420
173456: SEN	
173460: BPL	173420
173462: BLT	173420
173464: CLN	
173466: BGE	173420
173470: CCC	
173472: BLE	173420
173474: SCC	
173476: BGT	173420
173500: CALL	172034
173504: SXT	R2
173506: CALL	172034
173512: BR	173516
173514: BR	173534
173516: MOV	#177775, R3
173522: XOR	R3, R2
173524: CALL	172034
173530: SOB	R2, 173514
173532: BR     	173420
173534: CALL	172034
173540: ADD	#000043, R2
173544: CALL	172034
173550: ADD	R3, R2
173552: ADD	R2, (R4)
173554: CMP	#160045, (R4)
173560: BNE	173420
173562: JSR	R1, 172054		; Печать строки
	.WORD	175265
173570: CALL	174500
173574: MOV	#000012, @#157742
173602: MOV	@#177440, R1		; Клавиатура
173606: BIT	#000001, @#177442	; Клавиатура
173614: BEQ	173606
173616: MOV	#000253, @#177460
173624: CLR	R1
173626: BIT	#000002, @#177442	; Клавиатура
173634: BNE	173666
173636: DEC    	R1
173640: BNE    	173626
173642: JSR    	R1, 172050
	.WORD	171000, 175306
173652: CALL   	174500
173656: DEC    	@#157742
173662: BNE    	173602
173664: BR     	173746
173666: MOV	@#177440, R0		; Клавиатура
173672: BIC	#177400, R0
173676: CMP	#000001, R0
173702: BNE	173642
173704: BIT	#000002, @#177442	; Клавиатура
173712: BEQ	173704
173714: MOV	@#177440, R0		; Клавиатура
173720: BIC	#177400, R0
173724: BNE	173642
173726: MOV	#110021, R3
173732: CALL	177040
173736: JSR	R1, 172050		; Печать строки "Клавиатура готова"
	.WORD	034000, 175502		;   атрибуты, адрес строки
173746: MOV	#177640, R4
173752: MOV	#000030, @#157720
173760: MOV	@#157720, @#177600	; Системный регистр A
173766: MOV	#000003, R1
173772: MOV	#177777, R3
173776: SOB	R3, 173776
174000: SOB	R1, 173772
174002: MOV	#000012, @#157742
174010: MOV	#000300, R0
174014: CALL	174436
174020: BITB	#000020, (R4)
174024: BEQ	174070
174026: DEC    	@#157742
174032: BNE    	174040
174034: JMP    	174316			; ошибка => НГМД не готов
174040: MOV    	#000003, R0
174044: CALL   	174436
174050: MOV    	#020000, R1
174054: SOB    	R1, 174054		; задержка
174056: MOV    	#000103, R0
174062: CALL   	174436
174066: BR     	174010
174070: MOVB	@#177644, @#177642	; Регистр сектора -> регистр дорожки
174076: MOVB	#000001, 000006(R4)
174104: MOV	#000035, R0
174110: CALL	174436
174114: MOV	#020000, R1
174120: SOB	R1, 174120		; задержка
174122: BITB	#000020, (R4)
174126: BEQ	174142
174130: DEC    	@#157732
174134: BNE    	174002
174136: JMP    	174316			; ошибка => НГМД не готов
174142: MOV	#000005, R2
174146: MOV	#000103, R0
174152: CALL	174436
174156: SOB	R2, 174146
174160: MOV	#000300, R0
174164: CALL	174436
174170: BITB	#000020, (R4)
174174: BEQ	174210
174176: DEC    	@#157742
174202: BNE    	174160
174204: JMP    	174316			; ошибка => НГМД не готов
174210: MOVB	@#177644, R5		; Регистр сектора
174214: BIC	#177400, R5
174220: CMP	#000006, R5
174224: BEQ	174232
174226: JMP    	174316			; ошибка => НГМД не готов
174232: MOV	#000005, R2
174236: MOV	#000143, R0
174242: CALL	174436
174246: SOB	R2, 174236
174250: MOV	#000300, R0
174254: CALL	174436
174260: BITB	#000020, (R4)
174264: BEQ	174300
174266: DEC    	@#157742
174272: BNE    	174250
174274: JMP    	174316			; ошибка => НГМД не готов
174300: MOVB	@#177644, R5		; Регистр сектора
174304: BIC	#177400, R5
174310: CMP	#000001, R5
174314: BEQ	174376			; НГМД готов => переходим к загрузке
174316: JSR	R1, 172050		; Печать строки "КНГМД не готов - ПУЛЬТОВЫЙ режим"
	.WORD	171000, 175337		;   атрибуты, адрес строки
174326: BIS	#000017, @#157720	; биты НГМД
174334: MOVB	@#157720, @#177600	; Системный регистр A
174342: CALL	174500			; Мелодия на старте
174346: TST	@#157752
174352: BEQ	174364
174354: CLR	@#157752
174360: JMP	173746
174364: MOV	#034000, @#157714
174372: JMP	177066			; Изменить разрешение экрана и перейти в пульт
;
174376: BIS	#000200, @#157760
174404: BIS	#000010, @#157706
174412: MOV	@#157706, @#177604	; Системный регистр C
174420: JSR	R1, 172054
	.WORD	175407
174426: CLR	@#157752
174432: JMP	162252			; На загрузку с НГМД
;
; Подпрограмма, вызов по R5
174436: CLR	177776(SP)
174442: BIT	#000200, (R4)
174446: BEQ	174460
174450: DEC	177776(SP)
174454: BNE	174442
174456: BR	174316			; ошибка => НГМД не готов
174460: MOV    	R0, (R4)
174462: BITB   	#000001, (R4)
174466: BEQ    	174462
174470: BITB   	#000001, (R4)
174474: BNE    	174470
174476: RETURN 	
;
; Подпрограмма: Мелодия на старте
174500: JSR	R5, 174540		; звук
	.WORD	013630			; 6040. = 331.126 Гц ~= 329,63 Гц E  1 октавы
174506: JSR	R5, 174540		; звук
	.WORD	011271			; 4793. = 417.275 Гц ~= 415,30 Гц G# 1 октавы
174514: JSR	R5, 174540		; звук
	.WORD	007677			; 4031. = 496.155 Гц ~= 493,88 Гц B  1 октавы
174522: JSR	R5, 174540		; звук
	.WORD	005714			; 3020. = 662.252 Гц ~= 659,26 Гц E  2 октавы
174530: JSR	R5, 174540		; звук
	.WORD	013630			; 6040. = 331.126 Гц ~= 329,63 Гц E  1 октавы
174536: RETURN	
; Подпрограмма с вызовом по R5: звук
174540: MOV	(R5)+, R3		; берём задержку для таймера
174542: CALL	174550			; звук
174546: RTS	R5
; Подпрограмма генерации звука, R3 задаёт задержку для таймера
174550: BIC	#000340, @#177604	; таймер звука выкл, звук выкл, тон звука выкл
174556: MOVB	#000266, @#177526	; канал 2: будет загрузка младшего и старшего байта, режим 3 (генератор меандра)
174564: MOV	#000140, R4		; значение счётчика = 96.
174570: MOVB	R3, @#177524		; передаём младший байт
174574: SWAB	R3			;
174576: MOVB	R3, @#177524		; передаём старший байт
174602: BIS	#000300, @#177604	; таймер звука вкл, звук вкл
174610: MOV	174652, R0		; значение малого счётчика = 005777
174614: SOB	R0, 174614		; ожидаем
174616: SOB	R4, 174610		; ожидаем
174620: BIC	#000340, @#157706	; таймер звука выкл, звук выкл, тон звука выкл
174626: MOV	@#157706, @#177604	; Системный регистр C
174634: MOV	#000002, R4		; счётчик = 2
174640: MOV	174654, R0		; значение малого счётчика = 017777
174644: SOB	R0, 174644		; ожидаем
174646: SOB	R4, 174640		; ожидаем
174650: RETURN	
174652: .WORD   005777			; Значение для счётчика генерации звука
174654: .WORD   017777			; Значение для счётчика генерации звука
174656:	.WORD	177777
174660: .BYTE	033, 131, 044, 050
	.ASCIZ	/                       /
174714:	.BYTE	033, 131, 045, 050
174720:	.ASCII	/ Э л е к т р о н и к а /

175073: .ASCIZ	/  Кбайт/
175103: .ASCIZ	<033><131>/Дополнительное /
175127: .ASCIZ	<033><131>/Дисплейное     /

175232:	.ASCII	/0008162432404856/
175252: .ASCIZ	<033><131><066><054>/Дефект/
175272:	.ASCIZ	<033><131><066><051>/Без дефектов/
175306:	.ASCIZ	

175344:	.ASCII	/НГМД не готов/

; Подпрограмма: ожидание ввода символа с клавиатуры
175546: CALL	175556
175552: BLO	175546
175554: RETURN	
; Подпрограмма: Проверка клавиатуры нажата ли клавиша
175556: MOV	R1, -(SP)
175560: MOV	R2, -(SP)
175562: MOV	R3, -(SP)
175564: MOV	#157770, R1
175570: CALL	177012
175574: BEQ	175624
175576: INC    	R2
175600: ADD    	#157770, R2
175604: MOVB   	(R2), R0
175606: INCB   	(R1)
175610: TST	#000261
175612: SEC	
175614: MOV	(SP)+, R3
175616: MOV	(SP)+, R2
175620: MOV	(SP)+, R1
175622: RETURN	
175624: MOV	#000017, R3
175630: BIT	#000002, @#177442	; Клавиатура
175636: BNE	175644
175640: SOB	R3, 175630
175642: BR	175612
175644: MOVB	@#177440, R2		; Клавиатура
175650: BIC	#177400, R2
175654: TST	@#157766		; Переключатель звука??
175660: BEQ	175666
175662: CALL   	166350
175666: CMP	R2, #000256
175672: BLO	175704
175674: BNE	175710
175676: INC    	@#157716
175702: BR     	175612
175704: JMP	176236
175710: CMP	R2, #000264
175714: BHI	176112
175716: BNE    	175726
175720: BICB   	#000003, (R1)
175724: BR     	175564
175726: CMP    	#000263, R2
175732: BNE    	175746
175734: CLR    	@#157716
175740: CLR    	@#157724
175744: BR     	175612
175746: CMP    	R2, #000257
175752: BNE    	175762
175754: INC    	@#157724
175760: BR     	175612
175762: CMP    	R2, #000260
175766: BNE    	176022
175770: COMB   	@#157722
175774: TST    	@#157722
176000: BNE    	176010
176002: MOV    	#102021, R3
176006: BR     	176014
176010: MOV    	#102023, R3
176014: CALL   	177040
176020: BR     	175612
176022: CMP    	R2, #000262
176026: BNE    	176020
176030: BIT    	#000010, @#157760
176036: BEQ    	176060
176040: MOV    	#000017, R0
176044: MOV    	#110021, R3
176050: BIC    	#000010, @#157760
176056: BR     	176076
176060: MOV    	#000016, R0
176064: MOV    	#110023, R3
176070: BIS    	#000010, @#157760
176076: CALL   	177040
176102: TSTB   	@#157723
176106: BEQ    	175612
176110: BR     	176220
176112: SUB	#000274, R2
176116: TSTB	@#157722
176122: BNE	176140
176124: TSTB	@#157716
176130: BNE	176140
176132: ADD	#176550, R2
176136: BR	176144
176140: ADD    	#176652, R2
176144: MOVB	(R2), R0
176146: TST	@#157724
176152: BEQ	176162
176154: BIC    	#177740, R0
176160: BR     	176220
176162: TSTB	@#157723
176166: BNE	176220
176170: BIT	#000010, @#157760
176176: BEQ	176220
176200: CMP    	#000177, R0
176204: BEQ    	176220
176206: CMP    	R0, #000100
176212: BLO    	176220
176214: BIS    	#000200, R0
176220: MOV	#157770, R1
176224: MOVB	#000011, (R1)+
176230: MOVB	R0, (R1)
176232: JMP	175610
;
176236: CMP	R2, #000241
176242: BLO	176276
176244: SUB    	#000241, R2
176250: ADD    	#177000, R2
176254: MOVB   	(R2), R0
176256: MOV    	#157770, R1
176262: MOVB   	#000021, (R1)+
176266: MOVB   	#000033, (R1)+
176272: MOVB   	R0, (R1)
176274: BR     	176352
176276: CMP	R2, #000222
176302: BLO	176362
176304: SUB	#000222, R2
176310: ADD	#176760, R2
176314: MOVB	(R2), R0
176316: TST	@#157762
176322: BEQ	176544
176324: BIS    	#000100, R0
176330: MOV    	#157770, R1
176334: MOVB   	#000031, (R1)+
176340: MOVB   	#000033, (R1)+
176344: MOVB   	#000077, (R1)+
176350: MOVB   	R0, (R1)
176352: MOV    	#000033, R0
176356: JMP    	175610
176362: CMP	R2, #000131
176366: BNE	176420
176370: TSTB   	@#157717
176374: BNE    	176406
176376: COMB   	@#157717
176402: JMP    	160502			; Возврат к приглашению пульта и вводу команды
176406: CLRB   	@#157717
176412: MOV    	#000005, R0
176416: BR     	176220
176420: CMP	R2, #000212
176424: BLO	176514
176426: SUB    	#000131, R2
176432: MOV    	#157770, R1
176436: TSTB   	@#157723
176442: BEQ    	176470
176444: MOVB   	#000041, (R1)+
176450: MOVB   	#000033, (R1)+
176454: MOVB   	#000133, (R1)+
176460: MOVB   	R2, (R1)+
176462: MOVB   	#000176, (R1)
176466: BR     	176352
176470: MOVB   	#000031, (R1)+
176474: MOVB   	#000233, (R1)+
176500: MOVB   	R2, (R1)+
176502: MOVB   	#000176, (R1)+
176506: MOV    	#000233, R0
176512: BR     	176356
176514: CMP	R2, #000164
176520: BLO	176526
176522: JMP	175612
176526: CMP	R2, #000161
176532: BLO	176522
176534: SUB    	#000161, R2
176540: MOVB   	176754(R2), R0
176544: JMP	176220
;
176550:	.WORD	

176652:	.WORD	
177012: MOVB	(R1), R2
177014: BIC	#177770, R2
177020: MOVB	(R1), R3
177022: ASR	R3
177024: ASR	R3
177026: ASR	R3
177030: BIC	#177770, R3
177034: CMP	R3, R2
177036: RETURN	
;
177040: MOV	#000002, R1
177044: BITB	#000001, @#177442	; Клавиатура
177052: BEQ	177044
177054: MOVB	R3, @#177460		; Клавиатура
177060: SWAB	R3
177062: SOB	R1, 177044
177064: RETURN	
; Команда пульта 'H' - Изменить разрешение экрана
177066: TSTB	@#157760
177072: BPL	177130
177074: CLR	@#157760
177100: BIC	#000010, @#157706
177106: BR	177144
177110: MOV    	R0, #010000
177114: MOV    	#001000, R1
177120: XOR    	R1, (R0)
177122: SWAB   	(R0)
177124: SOB    	R1, 177120
177126: RETURN 	
177130: BIS	#000200, @#157760
177136: BIS	#000010, @#157706	; Вкл. высокое разрешение экрана
177144: MOVB	@#157706, @#177604	; Системный регистр C
177152: JMP	160416			; Очистка экрана и возврат в пульт
; Команда пульта 'K' - Установить КОИ7 (7K) или КОИ8 (0K)
177156: BIT	#000040, R1		; Есть параметр команды?
177162: BEQ	177202			; нет => неизвестная команда пульта
177164: BIC	#177770, R5		; параметр урезаем до 0..7
177170: TST	R5			; параметр 0?
177172: BEQ	177206			; да => переход
177174: CMPB	#000007, R5		; параметр 7?
177200: BEQ	177214			; да => переход
177202: JMP	161600			; Неизвестная команда пульта
177206: BIC    	#000004, @#157760
177214: MOVB	R5, @#157723
177220: JMP	160502			; Возврат к приглашению пульта
;
177224:	.BYTE	015, 012
177226:	.BYTE	100, 000
177230:	.BYTE	015, 012, 000
177233:	.BYTE	033, 110, 033, 112, 000
; Символы-команды, вводимые в режиме пульта, адреса программ см. 177264
177240: .BYTE	057, 015, 012, 136	; '/', <015>, <012>, '^'
	.BYTE	100, 137, 122, 107	; '@', '_', 'R', 'G'
	.BYTE	120, 177, 010, 114	; 'P', <177>, <010>, 'L'
	.BYTE	101, 102, 104, 110	; 'A', 'B', 'D', H'
	.BYTE	126, 113, 000, 000	; 'V', 'K'
; Адреса программ обработки символов в режиме пульта
177264:	.WORD	161060, 161112, 161176, 161204	; '/', <015>, <012>, '^'
	.WORD	161614, 161670, 161476, 161730	; '@', '_', 'R', 'G'
	.WORD	161774, 162046, 162046, 162334	; 'P', <177>, <010>, 'L'
	.WORD	162064, 162214, 162252, 177066	; 'A', 'B', 'D', H'
	.WORD	162324, 177156			; 'V', 'K'

177330: .ASCIZ	<015><012>/ОШИБКА ЗАГРУЗКИ/
177352: .ASCIZ	<010>/   LOAD   /<010>


177400:			; Регистр диспетчера памяти

177440:			; Клавиатура: буфер данных приёмника (R)
177442:			; Клавиатура: регистр состояния порта (R) / регистр инструкций (W)
177460:			; Клавиатура: буфер данных передатчика
177462:			; Клавиатура: регистр уплавления (R)

177500:			; Таймер канал 0
177502:			; Таймер канал 1
177504:			; Таймер канал 2
177506:			; Таймер упр.слово

177520:			; Таймер канал 0 (W)
177522:			; Таймер канал 1 (W)
177524:			; Таймер канал 2 (W)
177526:			; Таймер упр.слово (W)

177540:
177542:			; Клавиатура
177544:			; Клавиатура
177546:			; ИРПР: регистр управления

177600:			; Системный регистр A
177602:			; Системный регистр B
177604:			; Системный регистр C
177606:			; Управляющее слово программируемого интерфейса

177640:			; НГМД состояние (R) / команда (W)
177642:			; НГМД дорожка
177644:			; НГМД сектор
177646:			; НГМД данные

177700:			; Стык С2
177702:			; Стык С2

