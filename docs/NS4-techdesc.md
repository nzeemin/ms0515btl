Модуль системный НС4

Техническое описание

3.858.420 ТО

## 1. Введение
```
     1.1. Настоящее техническое описание (ТО) предназначено для ознакомления
с модулем системным НС4, входящим в состав ПЭВМ “Электроника МС 8515”, и
устанавливает правила эксплуатации, соблюдение которых обеспечивает
поддержание модуля в работоспособном состоянии.
     1.2. При ознакомлении с модулем НС4 необходимо дополнительно
руководствоваться схемой электрической принципиальной 3.858.420 ЭЗ и
перечнем элементов 3.858.420 ПЭЗ.
     1.3. Сокращения и условные обозначения, принятые в ТО приведены в
Табл.1.

                                                        Таблица 1

+-------------------------------------------------------------------------+
!Сокращённое,!              Полное наименование или значение              !
!условное    !                                                            !
!обозначение !                                                            !
+-------------------------------------------------------------------------+
!     МП     ! Микропроцессор                                             !
!     ЦП     ! Центральный процессор                                      !
!     ОЗУ    ! Оперативное запоминающее устройство                        !
!     ВОЗУ   ! Оперативное запоминающее устройство видеоконтроллера       !
!     НГМД   ! Накопитель на гибком магнитном диске                       !
!     РОН    ! Регистры общего назначения                                 !
!     РС     ! Регистр состояния                                          !
!     РКС    ! Регистр команд и состояния                                 !
!     ДП     ! Диспетчер памяти                                           !
!     ИРПР   ! Интерфейс радиальный параллельный                          !
!     ОС     ! Операционная система                                       !
!     УС     ! Указатель стека                                            !
!     СК     ! Счетчик команд                                             !
!     ССП    ! Слово состояния процессора                                 !
!     ПДП    ! Доступ к памяти                                            !
!     L      ! Используется с обозначением сигнала и указывает на то,     !
!            ! что активным уровнем является уровень логического нуля     !
!     H      ! Используется с обозначением сигнала и указывает на то,     !
!            ! что активным уровнем является уровень логической единицы   !
!     ЭО     ! Элемент отображения электронно-лучевой трубки              !
!            ! видеомонитора                                              !
!     ЭЛТ    ! Электронно-лучевая трубка                                  !
!     ЧТ     ! Чтение                                                     !
!     ЗП     ! Запись                                                     !
!     РГН    ! Регенерация                                                !
!     ППР    ! Предоставление прерывания                                  !
!     ПДП    ! Прямой доступ к памяти                                     !
!     ВПП    ! Введение приоритета процессора                             !
!     НОП    ! Нет операции                                               !
!     ППЗУ   ! Перепрограммированное ПЗУ                                  !
!     ПРМС2  ! Приёмник Стык С2                                           !
!     ПРДС2  ! Передатчик Стык С2                                         !
!     БФК    ! Блок формирования видеосигнала                             !
!     БВК    ! Буфер видеоконтроллера                                     !
!     БРПРД  ! Буфер регистра передатчика                                 !
!     ФАПЧ   ! Фазовая автоподстройка частоты                             !
!     МОН    ! Монитор                                                    !
!     УСАПП  ! Универсальный синхронно-асинхронный программируемый        !
!            ! приемо-передатчик                                          !
!     МЧМ    ! Модифицированная частота модуляции                         !
!     БИСК   ! Бис контроллера                                            !
!     КЦК    ! Контрольный циклический код                                !
!     ЦАП    ! Цифро-аналоговый преобразователь                           !
!            !                                                            !
+-------------------------------------------------------------------------+
```

## 2. Назначение
```
     2.1 Модуль системный НС4 предназначен для обработки и ввода/вывода
цифровой информации в составе ПЭВМ “Электроника МС 8515” и является
основным её элементом.
     На нём размещены центральный процессор, постоянное-запоминающе
устройство (ПЗУ), оперативное-запоминающее устройство (ОЗУ), видеоконтроллер,
контроллер НГМД, интерфейсы для связи с внешними устройствами.
     Модуль системный изготовляют в климатическом исполнении по 2 группе
условий применения, установленном в ОСТ 11 385.918-83.
     Питание осуществляется от стабилизированного источника постоянного тока
напряжениями плюс (5+-0,25) В, плюс (12+-0,6) В и минус (12+-0,6).
```

## 3. Основные технические характеристики
```
     3.1. Основные технические характеристики модуля системного приведены в
Табл. 2.

                                                           Таблица 2

---------------------------------------------------------------------------
     Параметры, единица измерения            !    Норма    !  Примечание  !
---------------------------------------------------------------------------
 1. Разрядность чисел, бит                   !     16      !              !
 2. Базовый микроцикл, нс                    !     400     !              !
 3. Быстродействие, млн коротких операций/с, !             !              !
                                  не менее   !     0,5     !              !
 4. Ёмкость памяти, кбайт,                   !             !              !
      ОЗУ                                    !     128     !              !
      ПЗУ                                    !     16      !              !
 5. Число регистров общего назначения        !     8       !              !
 6. Время цикла обращения к ОЗУ, мкс,        !             !              !
                                 не более    !     0,6     !              !
 7. Время выполнения одноадресных команд,    !             !              !
    типа очистка, мкс                        !     1,6     !              !
 8. Объём адресуемой памяти, кбайт           !     128     !              !
 9. Число методов адресации                  !     12      !              !
10. Число уровней приоритета прерывания ЦП   !     4       !              !
11. Токи, потребляемые от источников         !             !              !
    питания, а, не более,                    !             !              !
    плюс 5 В                                 !     2       !              !
    плюс 12 В                                !     0,1     !              !
    минус 12 В                               !     0,02    !              !
                                             !             !              !
---------------------------------------------------------------------------
     Примечания:
     1. Цифровая форма обрабатываемых данных и алфавитно-цифровая в кодах
     ГОСТ 13052-74.
     2. Единицы обрабатываемой информации: бит, байт, слово (16-разрядов).

     3.2. Количество выполняемых команд – 66. Система команд приведена в
ПГЩМ2.791.064 ТО.
     3.3. Типы команд: безадресные, одноадресные, двухадресные.
     3.4. Методы прямой адресации: регистровый, автоинкрементный,
автодекрементный, индексный.
     Методы косвенной адресации: косвенно-регистровый,
косвенно-автоинкрементный, косвенно-автодекрементный, косвенно-индексный.
     При использовании счетчика команд (СК) в качестве регистра общего
назначения выделяют четыре метода адресации: абсолютный, относительный,
косвенно-относительный и непосредственный.
     3.5. Система прерываний – векторная.
     3.6. Организация оперативной памяти – страничная.
     3.7. Габаритный размеры модуля системного НС4 – 288 Х 226,5 Х 30 мм;
масса – 0,4 кг.
```

## 4. Устройство и работа модуля системного
```
     4.1. Структурная схема системного модуля приведена на Рис.1.
Он состоит из следующих основных функциональных узлов:
     - центрального процессора;
     - оперативного запоминающего устройства (ОЗУ);
     - постоянного запоминающего устройства (ПЗУ);
     - догики прерывания ЦП;
     - видеоконтроллера;
     - арбитра ОЗУ;
     - системных регистров;
     - программируемого таймера;
     - интерфейсов внешних устройств;
     - интерфейса магнитофона;
     - контроллера НГМД.

     4.2. Основой системного модуля является блок ЦП, который служит для
осуществления процесса логической и арифметической обработки информации,
формирования управляющих сигналов и обслуживания запросов прерывания. Блок
ЦП построен на основе микропроцессора КР1807ВМ1. Этот 16-разрядный
микропроцессор совместим по системе команд с семейством машин типа
“Электроника 60”. Внутренние регистры микропроцессора могут быть выделены в
три группы по типу применения:
     - регистры общего назначения (РОН);
     - слово состояния процессора (ССП);
     - регистр режима.

                                                 Блок-схема системного модуля

                                  ...........................
                      ------------!                         !--------------
                      ! ----------!         О З У           !------------
                      !!          !                         !            !
                      !!          ...........................            !
                      !!             /\      /\     /\                   !
                      \/              !      !!     !!                   \
..........       .........       ........    !!  ............          ............
! Логика ! СР0-3 !       !       !АРБИТР!    !!  !Мульти-   !  АВ1-13  !Видео-    !
!прерыва-!------\!  ЦП   !       !      !    !!  !плексор   !/---------!контроллер!
!  ния   !------/!       !       ! ОЗУ  !    !!  !адреса ОЗУ!\---------!          !
..........       .........       ........    !!  ............          ............
                 /\  /\          /\          !!    /\   /\                !  /\
       ----------!   !!           !          !!     !   !!                !   !
       !             !!           -----------!!-----!---!!-----------------   ----
       !             !!                      !!     !   !!                       !
       !      МК0-15 !!         ..........   !!     !   !!            .......... !   ...........    ...........
       !             !!         !Рег.    !   !!     !   !!            !Контрол-! ----!Системные!--->!Интерфейс!
       !             !!         !выбора  !---!!-----!   !!            !  лер   !     !         !    !магнито- !
       !             !!         !банк ОЗУ!   !!         !!            !  МГМД  !<----!регистры !<---!фона     !
       !             !!         ..........   !!         !!            ..........     ...........    ...........
       !             !!             /\       !!         !!                 /\          /\   !
       !             !!       МК0-7 !!       !! МК0-15  !!           МК0-7 !!    МК0-7 !!   !--------------
       !             \/             !!       !!         !!                 \/          \/                 !
   ----!------------------------------------------------!!-------------------------------------------\    !
МК0-5  !             МК0-15                             !!                                            >   !
  !!---!------------------------------------------------!!-------------------------------------------/    !
  !!   !                          /\                    !!               /\         /\                    !
  \/  \/                          !!                    !!               !!         !!                    !
..........                    ..........                !!               !! МК0-7   !! МК0-7              !
!Регистр !                    !        !                !!АД1-12         !!         !!                    !
!        !                    !  ПЗУ   !                !!               !!         !!                    !
!адреса  !                    !        !                !!               !!         !!                    !
..........                    ..........                !!               \/         \/                   \/
    !!                         /\   /\                  !!         ............    ..........      ............
    !!        ..........       !!   !                   !!         !Интерфейсы!<---!Програм-!      !Схема     !
    !!        !Адресный!       !!   !                   !!         !внешних   !    !мируемый!----->!управлен. !
    !!        !        !       !!   !                   !!         !устройств !<---!таймер  !      !громкогов.!
    !!        !селектор!       !!   !                   !!         ............    ..........      ............
    !!         ..........      !!   !                   !!             /\  /\         /\  /\
    !!          /\   !         !!   !                   !!              !   !          !   !
    !!    АД5-15!!   !  АД1-13 !!   !                   !!              !   !          !   !
    !!          !!   !---------!!---+-------------------!!------------------!----------!   !
    !!          !!             !!                       !!                  ! АД1-2        ! АД1-2
    !!----------!!-------------!!-----------------------!!------------------!--------------!----------------\
    !                           АД0-15                                                                       >
    !-------------------------------------------------------------------------------------------------------/

                                                          Рис.1

     4.2.1. Регистры общего назначения (РОН)
     МП содержит восемь 16-разрядных РОН, которые обозначаются R0-R7 и могут
быть использованы в качестве аккумуляторов, индексных регистров,
автоинкрементных, автодекрементных регистров, указателя стека либо для
временного хранения данных. Регистры R6 и R7 являются специальными. Регистр
R6 используется в качестве указателя стека (УС) и содержит адрес последней
ячейки стека. Регистр R7 используется в качестве счётчика команд (СК)
процессора и содержит адрес следующей команды. Он обычно используется для
целей адресации, а не в качестве аккумулятора.

     4.2.2. Слово состояния процессора
     Слово состояния процессора содержит информацию о текущем состоянии
процессора, которая отражает приоритет процессора, признаки, описывающие
логические или арифметические результаты последней выполненной команды и
указатель для определения операции, которая вызвала прерывание при отладке
программы. Этот индикатор (Т-бит) не может быть непосредственно установлен
или очищен, изменение состояния Т-бита происходит при обращении к программе
прерывания. Формат ССП показан на Рис.2.

                    Формат слова состояния процессора

         15 14 13 12 11 10  9  8  7  6  5  4  3  2  1  0
        -------------------------------------------------
        :  :  :  :  :  :  :  :  :  :  :  : T: N: Z: V: C:
        -------------------------------------------------
                                !Приоритет!

                                  Рис.2

     <15-8> читаются как нули;
     <7-5> определяет уровень приоритета процессора;
     <4> “T-бит” применяется в отладочных целях;
     <3> “N” устанавливается в “1” состояние, если результат предыдущей
     операции отрицательный;
     <2> “Z” устанавливается в “1” состояние, если результат предыдущей
     операции равен нулю;
     <1> “V” устанавливается в “1” состояние, если при выполнении предыдущей
     операции произошло переполнение;
     <0> “C” устанавливается в “1” состояние, если при выполнении предыдущей
     операции имел место перенос.

     4.2.3 Регистр режима
     Регистр режима служит для задания режима работы микропроцессора и
загружается в момент включения питания и каждый раз при выполнении стартовой
последовательности процессора.
     На модуле системном регистр режима ЦП читается следующим образом:

         15 14 13 12 11 10  9  8  7  6  5  4  3  2  1  0
        -------------------------------------------------
        : 1: 1: 1: 1: 0: 0: 1: 0: 1: 1: 1: 1: 1: 1: 1: 1:
        -------------------------------------------------

     Разряды <15-13> используются для выбора значения стартового адреса
микропроцессора. Адрес рестарта всегда равен стартовому адресу +4.

      <15>  <14>  <13>    Стартовый    Рестартовый
                            адрес         адрес
        1     1     1      172000        172004


     4.2.4. Цикл обращения к магистрали
     ЦП обеспечивает выполнение базового набора из 66 команд, совместимых с
набором команд Микро-ЭВМ “Электроника 60”.
     Каждая команда может быть выполнена за несколько циклов обращения к
магистрали. Циклы обращения к магистрали подразделяются на следующие группы:
     - чтение (ЧТ);
     - запись (ЗП);
     - регенерация (РГН);
     - предоставление прерывания (ППР);
     - прямой доступ к памяти (ПДП);
     - ввод приоритета процессора (ВПП);
     - нет операции (НОП);
     Каждый цикл обращения к магистрали может состоять из одного или двух
микроциклов. Микроцикл позволяет микропроцессору выполнить внутренние
функции, необходимые для обмена информацией с микроканалом, внутренней
пересылки данных и вычислений, в свою очередь, микроцикл состоит из фаз
тактирования процессора. Длительность микроцикла может меняться, и при
частоте тактирования микропроцессора 7,5 МГц длительность фазы МП составляет
133 нс, а базовый микроцикл равен 400 нс.

     4.2.5. Стартовый цикл центрального процессора
     Процесс запуска ЦП происходит следующим образом.
     При подаче питающего напряжения на плату запускается схема формирования
стартового импульса “СТАРТ H”, которая имеет порог срабатывания 4,6 В и
позволяет предостеречь процессор от ложного запуска при питании от
источников, не формирующих логические сигналы “АИП” и “АСП”.
     Результатом работы схемы запуска является формирование импульса высокого
логического уровня длительности порядка 128 мкс, что обеспечивает надёжный
запуск микропроцессора. В процессе выполнения стартовой последовательности
микропроцессор формирует импульс низкого уровня “УСТ L”, который и позволяет
ему считать регистр режима. Результатом выполнения стартовой
последовательности является формирование управляющих сигналов для
магистрального цикла чтения по стартовому адресу 172000.
     На рис. 3 приведена диаграмма магистрального цикла чтения в статическом
режиме 16-разрядных данных.
     Диаграмма магистрального цикла записи показана на рис. 4.

     4.3. Оперативное запоминающее устройство
     Оперативное запоминающее устройство (ОЗУ) имеет ёмкость 128 Кбайт и
служит для временного хранения информации. ОЗУ построено на БИС
динамического ОЗУ К565РУ5Г.
     Всё ОЗУ разбито на банки по 8 Кбайт. Микропроцессор имеет 16-разрядную
адресную шину, поэтому он может адресовать непосредственно только 64 Кбайт
ОЗУ или 8 банков. Эта часть ОЗУ называется основной памятью. Другая
половина ОЗУ называется дополнительной памятью. К ней процессор может
обратиться только через диспетчер памяти.

МК00-15Н -----------------               -------------
        /                 \             /   Данные    \
--------       Адрес       -------------               ---------------
        \                 /             \   чтения    /
         -----------------               -------------
         !85 НС! >121 нс !
*СР8-7                                   -------------------
                                        /  Запр. прерыван.  \
----------------------------------------                     ---------
                                        \     и ПДП         /
                                         -------------------
ПВАС L         !  143 нс !
----------------                                      ----------------
                \                                    /
                 ------------------------------------
ПВАК L                   !    < 220 нс   !
------------------------                        ----------------------
                        \! 105 нс !            /
                         ----------------------

ПРВ Н                             -----------------
                                 /                 \
---------------------------------                   ------------------

Примечание. СР0-7 обозначены выводы 32-39 микропроцессора

                                    Рис. 3

МК00-15  -----------------               -------------
        /                 \             /   Данные    \
--------       Адрес       -------------               ---------------
        \                 /             \   записи    /
         -----------------               -------------

ПВАС L  ! >85 нс ! >121 нс !
----------------                                     -----------------
                \                                   /
                 -----------------------------------
                  !       < 270 нс      !
ПВАК L
------------------------                       -----------------------
                        \!      310 нс       !/
                 !143 нс!---------------------

--------                                               ---------------
ПКЛБL   \                                             /
ПСТБL    ---------------------------------------------

                                   Рис. 4

     Диспетчер памяти представляет собой схему, позволяющую осуществлять
подключение к адресному пространству процессора вместо выбранного банка
основного ОЗУ, соответствующий банк дополнительного ОЗУ и наоборот. Адрес
банка дополнительного ОЗУ указывается в соответствующем разряде регистра
диспетчера памяти, который имеет магистральный адрес 177400. Формат регистра
диспетчера памяти показан на рис. 5

      15  14  13   12   11   10   9   8   7   6  5  4  3  2   1  0
     ---------------------------------------------------------------
     : Х : Х :НАЧ:СТРБ:РВБ1:РВБ0:ТАИ:МОН:ВОЗУ:  :  :  :  :  :  :  :
     ---------------------------------------------------------------
                                             ! Номер банка ОЗУ !

                                    Рис. 5

     Номера разрядов имеют взаимно однозначное соответствие с номером банков,
а двоичные данные, записываемые в эти разряды, определяют выбор основного или
дополнительного ОЗУ.
     Так, логическая “1”, записанная в один из разрядов <0-6> этого регистра,
определяет включение в адресное пространство процессора банка основного ОЗУ,
номер которого равен номеру разряда, в который произведена запись, а
логический “0” подключает соответствующий банк дополнительного ОЗУ.
     <7> разряд служит для модификации видео ОЗУ (ВОЗУ).
     Архитектура видеоконтроллера системного модуля такова, что ВОЗУ
физически совмещено с ОЗУ процессора. Процессор не может обратиться к ВОЗУ
непосредственно, т.к. физические адреса ВОЗУ находятся в странице внешних
устройств, адреса которой отданы под ПЗУ. Таким образом, адреса ВОЗУ
находятся “в тени” адресов ПЗУ. Для того, чтобы считать данные ВОЗУ или
модифицировать его содержимое, необходимо установить <7> разряд регистра ДП в
состояние “1”. Комбинация, записанная в <10> и <11> разряд регистра ДП,
будет определять виртуальное окно, через которое можно обратиться к ВОЗУ.

        <11>   <10>   !   Виртуальное окно ВОЗУ
     ---------------------------------------------
         0      0     !   000000 - 037777
         0      1     !   040000 - 077777
         1      Х     !   100000 - 137777
     ---------------------------------------------

Примечание. Х – состояние разряда не имеет значения

 <8> служит для инициирования программного запроса прерывания от монитора
 “1” устанавливает запрос прерывания от монитора;
 “0” сбрасывает запрос прерывания от монитора.
 <9> служит для разрешения прерывания от таймера
 “1”, записанная в этом разряде, разрешает прерывания
от системного таймера;
 “0” запрещает прерывания от таймера.
     <12,13> служат для программного формирования управляющий сигналов для
обеспечения обмена через параллельный интерфейс по протоколу, совместному с
ИРПР-М.
     <14,15> разряды не используются.

     4.4. Постоянное запоминающее устройство (ПЗУ)
     ПЗУ предназначено для постоянного хранения информации, необходимой для
функционирования системного модуля.
     ПЗУ организованно на двух БИС ППЗУ К573РФ4Б с ультрафиолетовым стиранием
информации и имеет ёмкость 16 Кбайт. К ПЗУ можно обратиться через адреса от
160000 до 177376. Таким образом, ЦП доступна только половина ёмкости ПЗУ.
Другая половина ПЗУ может быть разрешена для адресации в случае установки в
состояние “1” <7> разряда (“Расширенное ПЗУ”) системного регистра А. При
этом ЦП будет иметь доступ к полному объёму ПЗУ с 140000 до 177376, но 6 банк
ОЗУ исключается из адресного пространства, т.к. будет находиться “в тени”
адресов ПЗУ. Адреса с 177400 до 177776 отводятся под адреса внешних
устройств.
     Схема распределения адресного пространства ЦП показана на рис.6.

Nбанка
         ----------!-----------         ---------------------- 177776
         ! ВОЗУ 60000-77777   !177777   ! Системные регистры !
         !                    !         ---------------------- 177400
      7  ----------!-----------         !                    !
         ! ВОЗУ 40000-57777   !         !    П З У           !
         !                    !160000   !                    !
         ----------!-----------         ---------------------- 160000
         !                    !157777   !                    !
      6  ----------!-----------         ! Расширение ПЗУ     !
         !                    !140000   !    <7>=1           !
         ----------!-----------         ---------------------- 140000
         !                    !137777
      5  ----------!-----------
         !                    !120000
         ----------!-----------
         !                    !117777
      4  ----------!-----------
         !                    !100000
         ----------!-----------
         !                    !77777
      3  ----------!-----------
         !                    !60000
         ----------!-----------
         !                    !57777
      2  ----------!-----------
         !                    !40000
         ----------!-----------
         !                    !37777
      1  ----------!-----------
         !                    !20000
         ----------!-----------
      8КБ! Дополнительное ОЗУ !17777
    0    ----------!-----------
      8КБ!    Основное ОЗУ    !00000
         ----------!-----------
         15       8 7         0
            СТБ        МЛБ

                                     Рис.6

     Из схемы видно, что всё адресное пространство ЦП, имеющего 16-разрядную
адресную шину, от 000000 до 177777 разбито на 8 банков. Банки имеют номера
от 0 до 7. Адреса внутри любого банка с 0 до 6 одинаковы для обращения к
ячейкам как основной, так и дополнительной памяти. Выбор основной или
дополнительной памяти банка осуществляется установкой или сбросом
соответствующих разрядов регистра диспетчера памяти. Физические ячейки
памяти, отведенные под хранение видеоданных, расположены в 7 банки, но доступ
к ним осуществляется через виртуальное окно, которое может перемещаться с
помощью разрядов <10> и <11> регистра ДП. По завершении внутреннего
автотеста устанавливается виртуальное окно для доступа к ВОЗУ от 40000 до
77777. Адреса ПЗУ накладываются на адреса 6 и 7 банка, в исходном состоянии
для расширения доступного для пользователя ОЗУ запрещается расширение ПЗУ,
(<7> разряд системного регистра A сброшен), адреса регистров занимают
верхнюю область ПЗУ с 177400 по 177776.
     По завершении выполнения стартовой последовательности ЦП обращается к
стартовому адресу 172000, который попадёт в адресную область, отведённую под
ПЗУ. Процессор считывает информацию из ПЗУ, и до момента загрузки
операционной системы или запуска программ пользователя постоянно находится в
режиме выполнения программ ПЗУ.
     Программы ПЗУ могут быть разбиты на несколько групп по назначению:
     - тестовые;
     - эмуляции пультового терминала;
     - обслуживания ввода/вывода;
     - аппаратные загрузчики.
     К тестовым программам относятся программы внутреннего автотеста: тест
ЦП, тест ОЗУ, тест ВОЗУ, тест клавиатуры, тест НГМД, тест
звуковоспроизводящего устройства.
     Тестовые программы предназначены для проверки наличии и определения
функционирования аппаратных средств и выполняются каждый раз в
момент старта ЦП.
     Программа эмуляции пультового терминала позволяет пользователю с помощью
специального набора команд осуществлять непосредственный доступ к ячейкам
ОЗУ, ВОЗУ и внутренним регистрам системного модуля, а также осуществлять
управление видеоконтроллером и звуковоспроизводящим устройством.
     Команды пультового терминала приведены в Табл.3.

                                                             Таблица 3
---------------------------------------------------------------------------
Наименование  :            Действие, выполняемое по команде
команд        :
---------------------------------------------------------------------------
  “/”         : Открыть ячейку памяти
              :
  <ВК>        : Закрыть ячейку
              :
  <ПС>        : Закрыть ячейку и открыть следующую
              :
  “¬”         : Закрыть ячейку и открыть предыдущую
              :
  “ - ”       : Закрыть ячейку и открыть другую, адрес которой вычислен по
              : косвенно-индексному методу
              :
    R         : Открыть указанный РОН
              :
    G         : Запустить программу с указанного адреса
              :
    P         : Продолжить выполнение программы с адреса останова
              :
    A         : Управление атрибутами видеоданных
              :
    B         : Управление цветом окаймления экрана
              :
    K         : Переключение КОИ-7 / КОИ-8
              :
    H         : Изменить разрешение экрана
              :
    V         : Отключить звуковоспроизводящее устройство
              :
    L         : Запуск программы аппаратной загрузки с бытового кассетного
              : магнитофона
              :
    D         : Запуск программы аппаратной загрузки с НГМД
              :
---------------------------------------------------------------------------

     Программы обслуживания ввода/вывода служат для определения кода нажатой
на клавиатуре клавиши и вывода соответствующего ей символа в кодах КОИ-8 на
экран монитора с использованием резидентного знакогенератора.    
     Для обеспечения программной поддержки монитора в среде операционной
системы ПЗУ содержит программы, эмулирующие отработку набора управляющих
последовательностей терминала, программно совместимого с дисплеем 15ИЭ-00-013.
     ПЗУ содержит программы аппаратной загрузки с НГМД и бытового кассетного
магнитофона, вызов которых осуществляется командами пультового терминала “D”
и “L” соответственно (см. Табл.6).

     4.5. Логика прерываний

     4.5.1. Центральный процессор может работать в двух режимах:
программном и режиме прерывания.
     В режиме прерывания процессор временно приостанавливает выполнение
текущей программы для перехода к программе обслуживания внешнего устройства,
выставившего запрос прерывания. Устройство может вызвать прерывание
процессора, если его приоритет выше, чем текущий приоритет ЦП, записанный в
резисторах <5 - 7> ССП.
     Микропроцессор поддерживает векторную структуру обработки прерывания с
внутренней дешифрацией запросов и генерацией соответствующих векторов
прерывания четырёх уровней.

     4.5.2. Механизм прерывания процессора
     Процессор, получив запрос прерывания, не реагирует на него до окончания
текущей команды. Запросы прерывания могут быть считаны в магистральном цикле
чтения или в цикле ввода приоритета. Процессор анализирует приоритет
полученного запроса перед выборкой следующей команды, и, если он выше
текущего приоритета процессора, ЦП разворачивает магистральный цикл
предоставления прерывания, в результате которого текущий счётчик команд (СК)
и ССП помещается в стек, а новое значение СК и ССП выбирается по адресу
вектора прерывания.
     Коды запросов маскирующих прерывания передаются МП по четырём линиям
CP0- - CP3 L. Запрос “ОСТАНОВ L” передаётся по отдельной линии и является
немаскируемым запросом прерывания. Каждому коду прерывания, за исключением
“ОСТАНОВ L”, поставлен в соответствие свой вектор. Вектор прерывания
определяет начальный адрес двух следующих друг за другом 16-разрядных слов, в
первом из которых хранится новое значение СК, а во втором – новое значение
ССП. СК указывает адрес программы обслуживания внешнего устройства. ССП
содержит новую информацию, загружаемую в регистр состояния процессора. В
цикле предоставления прерывания текущие значения СК и ССП помещаются в стек,
а новые значения СК и ССП загружаются по адресу вектора прерывания.
     Значения адресов векторов прерывания от внешних устройств могут лежать в
пределах от 0 до 374 в восьмеричной системе счисления. Адрес вектора может
выбираться из внутренней таблицы фиксированных векторов самого
микропроцессора в результате дешифрации кодов запросов прерывания на линиях
CP0 - CP3 L (режим внутреннего адреса вектора). На системном модуле логика
прерывания использует второй режим внутреннего адреса вектора.


                                                             Таблица 4

---------------------------------------------------------------------------
: СР3 : СР2 : СР1 : СР0 : Уровень  :  Адрес   :                           :
:-----------------------:приоритета: вектора  :    Устройство / Линия     :
: МК08: МК09: МК10: МК11:          :          :                           :
---------------------------------------------------------------------------
: X   :  X  :  X  :  X  :    8     :    -     :           Останов         :
:     :     :     :     :          :          :                           :
: L   :  H  :  L  :  L  :    6     :  100     :           Таймер          :
:     :     :     :     :          :          :                           :
: L   :  H  :  H  :  L  :    6     :  110     :           ПРМ С2          :
:     :     :     :     :          :          :                           :
: L   :  H  :  H  :  H  :    6     :  114     :           ПРД С2          :
:     :     :     :     :          :          :                           :
: H   :  L  :  H  :  L  :    5     :  130     :           КЛ7004          :
:     :     :     :     :          :          :                           :
: H   :  H  :  L  :  L  :    4     :   60     :           КЛ7007          :
:     :     :     :     :          :          :                           :
: H   :  H  :  L  :  H  :    4     :   64     :           Монитор         :
---------------------------------------------------------------------------

      Примечания: 1) L – уровень логического нуля
                     H - уровень логической единицы
                     X - состояние вывода безразлично.
                  2) Запрос “Останов” не имеет соответствующего вектора
прерывания. При получении по этой линии уровня логического нуля МП помещает
текущие значения СК и ССП в стек, в СК загружается адрес рестарта
определяемый регистром режима (для системного модуля - 172004), а в ССП
загружается 340.
     Запросы прерывания считывается процессором во время магистральных циклов
чтения и ввода приоритета.
     Временная диаграмма цикла ввода приоритета показана на Рис.7.


                                ----------------
СР 0-7                         /  Запросы ПРР   \
       ------------------------   и ПДП          --------------------------
                               \                /
                                ----------------

ПВАС L
---------------------------------------------------------------------------



-------------------------             -------------------------------------
                         \           /
ПВАК L                    -----------


                             ---------
ПРВ H                       /         \
----------------------------           ------------------------------------

                                Рис.7


     Магистральный цикл ввод приоритета имеет место во время выполнения
команд: RESET, HALT, WAIT, в момент включения питания или обработки запроса
МП по линии останов.
     Запросы прямого доступа к памяти (ПДП) считываются как во время
магистральных циклов чтения, так и записи. На системном модуле режим ПДП не
используется.
     После завершения выполнения текущей команды и дешифрации принятых
запросов прерывания МП разворачивает цикл предоставления прерывания.
     Состояние выводов МП РЕЖ0 H, РЕЖ1 H определяет режим его работы в
соответствии с Табл.5.

                                                       Таблица 5

:---------------------------------------------------:
:   РЕЖ1 H  : РЕЖ0 H    : Режим работы МП           :
----------------------------------------------------:
:    H      :     L     : Предоставление прерывания :
:           :           :                           :
-----------------------------------------------------

     L – обозначает низкий уровень, соответствующий логическому нулю,
     H – обозначает высокий уровень, соответствующий логической единице.

     4.6. Видеоконтроллер (ВК) ===

     4.6.1. Видеоконтроллер резидентно размещён на системном модуле и
предназначен для формирования полного телевизионного сигнала, необходимого
для отображения на экране монитора информации, подготовленной процессором.
     Видеоконтроллер позволяет отображать информацию на мониторах, схема
синхронизации кадровой развёртки которых настроена на любую из частот 50, 60
или 72 ГЦ. Переключение кадровой синхрочастоты полного видеосигнала
производится с помощью перемычек, установленных на модуле системном.
     Блок-схема видеоконтроллера приведена на Рис.8. Он состоит из следующих функциональных узлов:
     - ВОЗУ;
     - ПЗУ;
     - регистров сдвига;
     - блока формирования видеосигнала.

     4.6.2. ВОЗУ имеет ёмкость 16 Кбайт, совмещено с основным ОЗУ
центрального процессора и предназначено для хранения видеоданных. Физические
адреса ВОЗУ расположены в области 160000 – 177777 адресного пространства ЦП.
     Видеоконтроллер для хранения содержимого экрана постоянно читает
информацию из ВОЗУ, осуществляя перебор адресов ячеек на физическом уровне,
тем самым происходит регенерация содержимого БИС динамического ОЗУ.
     Каждая ячейка памяти ВОЗУ поставлена в соответствие элементу отображения
(ЭО) на экране монитора, что позволяет осуществлять поэлементное управление
изображением. Элементу отображения, расположенному в левом верхнем углу
рабочей части экрана, соответствует начальный адрес ВОЗУ, а ЭО,
расположенному в правом нижнем углу экрана, соответствует конечный адрес
ВОЗУ.
     Доступ к ВОЗУ осуществляется со стороны видеоконтроллера и со стороны
ЦП. ЦП может осуществлять как чтение информации из ВОЗУ, так и запись для её
модификации.


              /---------------------\
             /        МК00-05        \
             \                       /
              \---------------------/
                       ! !
                       ! !
                     \-  -/
                      \  /
                       \/
                  ----------
                  ! ВОЗУ   !
                  !        !
                  ----------
                       ! !
                       ! !
                     \-  -/ Д00-Д15
                      \  /
                       \/              -------------  Данные    ----------
                  ----------           !           !----------->!        !
                  !  Буфер !--------!\ ! Регистры  !            !        !
                  !   ВК   !ДВ00-15   >!  сдвига   !---------!\ !        !   R
                  !        !--------!/ !           !Атрибуты ! >!        !--->
                  ----------           !           !---------!/ !        !
                                       !           !основного   !        !
                  -----------          !           !цвета       !  Блок  !
                  !  Схема  !          !           !            !формиро-!   G
                  !синхрони-!--------->!           !---------!\ !вания   !--->
                  !зации    !--------->!           !Атрибуты   >!видео-  !
                  ! сдвига  !          !           !---------!/ !сигнала !
                  -----------          !           ! фона       !        !
                     / \               !           !            !        !   B
                      !                -------------            !        !--->
                      !                                         !        !
                      !                 ----------------------\ !        !
                      !                 Атрибуты окаймления    >!        !
                      !                 ----------------------/ !        !МОНО
                      !                                         !        !--->
       ---------      !     ----------                          !        !
15МГц  !       !      !     !        !                          !        !
------>!Счётчик!-------     !  ПЗУ   !------------------------\ !        !
       !адресов!----------\ !        !   Синхросигналы         >!        !
------>! ПЗУ   !           >!  ВК    !------------------------/ !        !
!      !       !----------/ !        !----                      ----------
!      !       !            ----------   !
!      ---------                         !
!              Сброс                     !
------------------------------------------

                                     Рис.8


     Доступ ЦП к ВОЗУ осуществляется через перемещаемое виртуальное окно,
границы адресов которого определяются состоянием разрядов <10,11> регистра
ДП. Кроме того, для того, чтобы процессор получил доступ к ВОЗУ, необходимо
установить <7> разряд регистра ДП в состояние 1:

     Доступ ЦП к ВОЗУ осуществляется через перемещаемое виртуальное окно,
границы адресов которого определяются состоянием разрядов <10,11> регистра
ДП. Кроме того, для того, чтобы процессор получил доступ к ВОЗУ, необходимо
установить <7> разряд регистра ДП в состояние 1:

          15      12 11  10   9   8   7   6               0
          --------------------------------------------------
  177400  :         : 0 : 0 :   :   : 1 :                  :
          --------------------------------------------------

          Виртуальное окно ВОЗУ :  000000 – 37777


          15      12 11  10   9   8   7   6               0
          --------------------------------------------------
  177400  :         : 0 : 0 :   :   : 1 :                  :
          --------------------------------------------------

          Виртуальное окно ВОЗУ :  40000–77777


          15      12 11  10   9   8   7   6
          --------------------------------------------------
  177400  :         : 0 : 0 :   :   : 1 :                  :
          --------------------------------------------------

          Виртуальное окно ВОЗУ: 100000-137777


     4.6.3. ПЗУ видеоконтроллера (ВК) предназначены для выработки
синхросигналов кадровой и строчной развёртки полного телевизионного
видеосигнала, импульсов формирования окаймления экрана и сбросовых импульсов
для счётчиков адресов ПЗУ.
     ПЗУ ВК построены таким образов, что с помощью перемычек Е3, Е4 можно
осуществлять выбор временных соотношений синхросигналов для тех или иных
типов мониторов. В Табл.6 приведены параметры синхросигналов, выбираемые из
ПЗУ с помощью перемычек.


                                                             Таблица 6
---------------------------------------------------------------
: Состояние перемычки:  Временные параметры синхросигналов    :
:--------------------------------------------------------------
:     Е3   :    Е4   : Тссн, мкс: Тс, мкс :  Тк, мс :Fк, Гц  :
---------------------------------------------------------------
: Установ. : Установ.:  4,7     :   63,9  :  20     :   50    :
---------------------------------------------------------------
:Не устан. : Установ.:  4,7     :   63,9  :  16,7   :   60    :
---------------------------------------------------------------
: Установ. :Не устан.:  3,9     :   52,6  :  13,9   :   72    :
---------------------------------------------------------------


     Для выбора содержимого ПЗУ служат счётчик адресов, тактирование которых
осуществляется от кварцевого генератора 15МГц синхронно с ЦП. Сигналы
сброса, формируемые ПЗУ, заводятся на счётчики, обеспечивая возобновление
процесса формирования синхросигналов с нужной периодичностью. На Рис.9, 10
показаны временные соотношения выходных сигналов ПЗУ ВК за один такт их
работы.
     Данные. читаемые ВК из ВОЗУ, защёлкиваются сигналом ЧТВЗУ Н. В буфере
видеоконтроллера (БВК). Регистры сдвига осуществляют
параллельно-последовательный сдвиг видеоданных, поступающих из БВК в блок
формирования сигнала. Для управления сдвиговыми регистрами служит схема
синхронизации сдвига. Видеоконтроллер обеспечивает формирования изображения
в двух режимах:
     - в режиме среднего разрешения, при этом размер отображаемого поля на
экране монитора составляет 320х200 ЭО;
     - в режиме высокого разрешения, при этом размер отображаемой области
составляет 640х200 Э.О.
     Выбор режимов производится программно изменением состояния разряда <3>
системного регистра C (177604).
     ВК переводится в режим высокого разрешения установкой в единичное
состояние <3> разряда системного регистра “C”. Сброс <3> разряда в “0”
означает выбор режима среднего разрешения


            --------                 ----------- СТРВ
            !      !                 !
  БОРД L ----      -------------------

         ------------            ---------------
  СГИ L             !            !
                    --------------

  СCИ L ---------------   ССН  -------------------
                      !<----->!
                      ---------

СБРОС L --------------------------   -------------
                                  !  !
                                  ----

                            Рис.9


  БОРДК L ------               -------------------- КДРВ
               !               !
               -----------------

  КГИ L  ---------          ------------------------
                 !          !
                 ------------

 ПКСИ L  -----------     ---------------------------
                   !     !
                   -------

СБРКС L  -----------------  ------------------------
                         !  !
                         ----

                              Рис.10


     Разряды <0> - <3> этого же регистра позволяют выбирать цвет
неиспользуемой части экрана монитора (окаймления). Причём, если в режиме
среднего разрешения выбор окаймления производится независимо от цвета
изображения и фона, то в режиме высокого разрешения цвет фона совпадает с
выбранным цветом окаймления.
     Формат системного регистра С приведён на Рис.11.


               7              4     3       2       1         0
              -----------------------------------------------------
  177604      :                 :Разреш.:   G   :   R    :    B   :
              -----------------------------------------------------

                                      Рис.11

     <3> разрешение ВК          0 – среднее разрешение
                                1 – высокое разрешение
     <2-0> определяют цвет окаймления в соответствии с Табл.7.

                                                              Таблица 7

---------------------------------------------------------------------
:  <2>  :   <1>  :   <0>   :          Цвет окаймления               :
---------------------------------------------------------------------
    0   :   0    :    0    :           Чёрный                       :
    0   :   0    :    1    :           Синий                        :
    0   :   1    :    0    :           Красный                      :
    0   :   1    :    1    :           Пурпурный                    :
    1   :   0    :    0    :           Зелёный                      :
    1   :   0    :    1    :           Голубой                      :
    1   :   1    :    0    :           Жёлтый                       :
    1   :   1    :    1    :           Белый                        :
        :        :         :                                        :
---------------------------------------------------------------------


     В режиме среднего разрешения распределение ВОЗУ производится следующим
образом. Младший байт каждого 16- разрядного слова используется для хранения
видеоданных, а старший байт отводится под атрибуты.
     Атрибуты несут информацию о цвете основного изображения и фона,
интенсивности и мигании изображения.
     Каждому разряду байта данных ставится в соответствие элемент отображения
экрана монитора, причём, разряд видеоданных, равный единице раскрашивается в
соответствии с атрибутами основного изображения, а разряд равный “0” – в
соответствии с атрибутами фона.
     Формат байта атрибутов приведён на Рис.12.


          15    14    13    12    11    10    9    8
        -----------------------------------------------
        :  F  :  I  :  G’ :  R’ :  B’ :  G :  R :  B  :
        -----------------------------------------------

                                  Рис.12

     <15> F разряд мигания.
     F = 0 цвет изображения не меняется.
     F = 1 цвет изображения меняется на цвет фона с частотой 3 Гц.
     <14> I разряд интенсивности свечения ЭО, определяет градации яркости
изображения, распространяется на цвет фона и изображения.
     I = 0 понижение в два раза интенсивности свечения Э.О.
     I = 1 максимальная интенсивность свечения Э.О.
     <13-11> разряды, определяющие цвет фона.
     <10-8> разряды, определяющие цвет основного изображения.


--------------------------------------------------------------------------
: <13>:  <12>: <11> : <10> : <9>  : <8>  :   Цвет фона  :Цвет изображения:
--------------------------------------------------------------------------
:  1  :   1  :   1  :  0   :   0  :  0   :   Белый      :   Чёрный       :
:  1  :   1  :   0  :  0   :   0  :  1   :   Жёлтый     :   Синий        :
:  1  :   0  :   1  :  0   :   1  :  0   :   Голубой    :   Красный      :
:  1  :   0  :   0  :  0   :   1  :  1   :   Зелёный    :   Пурпурный    :
:  0  :   1  :   1  :  1   :   0  :  0   :   Пурпурный  :   Зелёный      :
:  0  :   1  :   0  :  1   :   0  :  1   :   Красный    :   Голубой      :
:  0  :   0  :   1  :  1   :   1  :  0   :   Синий      :   Жёлтый       :
:  0  :   0  :   0  :  1   :   1  :  1   :   Чёрный     :   Белый        :
:     :      :      :      :      :      :              :                :
--------------------------------------------------------------------------


     Так как атрибуты распространяются на весь байт видеоданных,
следовательно изображение в режиме среднего разрешения состоит из чёрточек,
соответствующих байту видеоданных. Цвет чёрточек может быть равен цвету фона
или цвету изображения. Таким образом цветовые возможности видеоконтроллера
характеризуются возможностью выбора двух цветов на чёрточку изображения из
палитры 8 цветов с двумя градациями яркости.
     Порядок обработки разрядов 16-разрядного слова видеоданных в режиме
среднего разрешения показан на Рис.13.


15
-----------------------------------------------------------------------
: F : I : G’: R’: B’: G : R : B : ДВ7: ДВ6: ДВ5: ДВ4: ДВ3: ДВ2:ДВ1:ДВ0:
-----------------------------------------------------------------------
         ----------------------------->
          Направление развёртки

                                   Рис.13

     Старший байт параллельно заносится в регистр сдвига и затем попадает на
мультиплексоры блока формирования видеосигнала (БФВ).
     Младший брат подвергается параллельно-последовательному преобразованию
на сдвиговых регистрах и в последовательном коде поступает на вход БФВ.
     БФВ состоит из двух основных узлов: мультиплексоров-селекторов, схемы
ЦАП и видеоусилителей.
     Мультиплексоры-селекторы ставят в соответствие видеоданным атрибуты
цвета, интенсивности, мигания и привязывают их к сигналам синхронизации
телевизионной развёртки изображения. Полученный цифровой сигнал поступает на
вход схемы ЦАП и видеоусилителей, которые завершают процесс формирования
полного телевизионного сигнала.
     В режиме высокого разрешения вся видеопамять используется для хранения
только данных, информация об атрибутах цвета отсутствует.
     Всё 16-разрядное слово, защелкнутое в БВК, подвергается
параллельно-последовательному сдвигу на сдвиговых регистрах, за счёт чего
достигается возможность отображения на экране монитора в два раза большего
количества ЭО за горизонтальный ход луча ЭЛТ, но возможно формирование только
монохромного изображения, при котором цвет фона совпадает с цветом
окаймления.
     В Табл.8 приведены возможные сочетания цветов фона и основного
изображения в режиме высокого разрешения.


                                                             Таблица 8
----------------------------------------------------------------------
:    Цвет фона (окаймления)  :         Цвет изображения              :
----------------------------------------------------------------------
:         Чёрный             :          Белый                        :
:         Синий              :          Жёлтый                       :
:         Красный            :          Голубой                      :
:         Пурпурный          :          Зелёный                      :
:         Зелёный            :          Пурпурный                    :
:         Голубой            :          Красный                      :
:         Жёлтый             :          Синий                        :
:         Белый              :          Чёрный                       :
:                            :                                       :
----------------------------------------------------------------------


     Порядок обработки 16-разрядного слова видеоданных в режиме высокого
разрешения показан на схеме.
     В БВК слово видеоданных помещается в обычном виде.

  15   14   13   12   11   10   9   8   7   6   5   4   3   2   1    0
------------------------------------------------------------------------
:ДВ15:ДВ14:ДВ13:ДВ12:ДВ11:ДВ10:ДВ9:ДВ8:ДВ7:ДВ6:ДВ5:ДВ4:ДВ3:ДВ2:ДВ1:ДВ00:
------------------------------------------------------------------------

     После сдвиговых регистров 16-разрядное слово преобразуется в
последовательном коде.

------------------------------------------------------------------------
:ДВ7:ДВ6:ДВ5:ДВ4:ДВ3:ДВ2:ДВ1:ДВ00:ДВ15:ДВ14:ДВ13:ДВ12:ДВ11:ДВ10:ДВ9:ДВ8:
------------------------------------------------------------------------
          ----------------------------->
          Направление развёртки

Последовательность высвечивания ЭО на экране монитора происходит в
направлении развёртки луча ЭЛТ слева-направо. Разряды, установленные в “1”,
имеют цвет изображения, разряды, имеющие значение логического нуля,
высвечиваются на экране в цвете окаймления.

     4.7 Арбитр ОЗУ

     Одним из наиболее важных узлов системного модуля является схема
арбитра ОЗУ.
     Арбитр ОЗУ предназначен для управления процедурой обращения к ОЗУ со
стороны ВК и ЦП, разрешения конфликтов при попытке одновременного обращения и
формирования сигналов управления для микросхем К565РУ5Г, обеспечивающих
надёжное чтение и запись информации.
     Принцип построения схемы арбитра следующая. ВК периодически, через 1
мс, выставляет запрос на обращение к памяти. Этот запрос запоминается на
триггере ТРВЗУ. ЦП может инициировать начало магистрального цикла обращения
к ОЗУ асинхронно по отношению к запросу ВК. При этом возможны три ситуации:
     1. Запрос ЦП пришёл во время выполнения обслуживания ВК. При этом
запрос ЦП запоминается, тактирование ЦП приостанавливается на высокой фазе до
завершения обслуживания ВК и затем продолжается с момента прихода активного
уровня “ПВАКL”, по которому сразу же начинается обслуживание ЦП.
     2. Запрос ВК пришёл во время выполнения цикла обращения к памяти ЦП.
При этом приоритет отдаётся процессору, запрос ВК запоминается и начинается
обслуживаться по завершении магистрального цикла процессора.
     3. При одновременном получении запросов ЦП и ВК, ВК обслуживается в
первую очередь.

     4.8. Системные регистры

     В процессе функционирования системного модуля для управления внешними
устройствами, ОЗУ, ПЗУ и ВК используются три 8-разрядных служебных регистра,
которые обозначены, как системные регистры A, B, C (приложение 1).
     Системные регистры аппаратно реализованы на БИС программируемого
интерфейса КР580ВВ55. Адрес управляющего слова для задания режима работы
177606, Адреса системных регистров A, B, C – 177600, 177602, 177604
соответственно.
     Программируемый интерфейс имеет три 8-разрядных порта: A, B, C.
Существует три режима работы схемы:
     - Режим 0, при котором 8-разрядные порты A и В могут быть
запрограммированы для работы либо на ввод, либо на вывод, а порт С
рассматривается как две независимые группы по 4 вывода, каждая из которых
может работать тоже либо на ввод, либо на вывод;
     - Режим 1, при котором порты А и В используются для ввода и вывода,
порт С используется для формирования сигналов управления в режиме поразрядной
установки и сброса;
     - Режим 2, порт А является двунаправленным, порт В – не используется, а
из порта С три шины используются для ввода или вывода, а пять оставшихся –
для формирования сигналов управления.
     Существует возможность поразрядного управления портом С в режимах 1 и 2.
     Для выбора режима работы программируемого интерфейса служит 8-разрядное
управляющее слово, обратиться к которому можно, используя магистральный адрес
177606.
     Формат управляющего слова приведён на Рис.14.


177606    7    6  5     4     3      2     1     0
        ----------------------------------------------
        :  1 : Реж А :  А  :  С  : Реж В :  В  :  С  :
        ----------------------------------------------
                              <4-7>             <0-3>

                                    Рис.14

     <7> ”1” должна быть установлена для выбора режима работы портов
интерфейса;
     “0” должен быть установлен для поразрядного управления портом С.
Допускается использование в режиме 1 или 2.
     <6,5> служат для выбора режима для порта А и старшего полубайта порта С
в соответствии с таблицей


                        --------------------------
                        :  <6>  :  <5>  :  Режим :
                        --------------------------
                        :   0   :   0   :   0    :
                        :   0   :   1   :   1    :
                        :   1   :   Х   :   2    :
                        --------------------------

                   Х – состояние разряда не анализируется

     <4> определяет направление обмена через порт А;
     “1” соответствует выбору режима работы на ввод;
     “0” – работа на вывод.
     <3> определяет направление обмена через старший полубайт порта С
(разряды с 4 по 7);
     “1” – работа на ввод;
     “0” – работа на вывод;
     <2> определяет режим работы для порта В и младшего полубайта порта С;
     “0” – режим 0;
     “1” – режим 1;
     <1> определяет направление обмена через порт В;
     “1” – соответствует выбору работы на ввод;
     “0” – работа на вывод;
     <0> определяет направление обмена через младший полубайт порта С;
     “1” – работа на ввод;
     “0” – работа на вывод;

     В случае поразрядного управления портом С формат управляющего слова
следующий:


          7  6               4  3    2    1      0
        ----------------------------------------------
        : 0 : Не используется :    :    :    :Уст/Сбр:
        ----------------------------------------------
                              !Выбор разряда !


     <3-1> определяет номер разряда порта С, которым осуществляется
управление. Соответствие кода в разрядах <3-1> номеру разряду приведено в
Табл.9.

                                                         Таблица 9
           ------------------------------
           : 3 : 2 : 1 :  Номер разряда :
           :   :   :   :     порта С    :
           ------------------------------
           : 0 : 0 : 0 :       0        :
           : 0 : 0 : 1 :       1        :
           : 0 : 1 : 0 :       2        :
           : 0 : 1 : 1 :       3        :
           : 1 : 0 : 0 :       4        :
           : 1 : 0 : 1 :       5        :
           : 1 : 1 : 0 :       6        :
           : 1 : 1 : 1 :       7        :
           ------------------------------


     <0> определяет состояние, в которое должен быть установлен
соответствующий разряд порта С, номер которого выбран разрядами <3-1>
управляющего слова.
     1 – соответствует установке разряда в состояние логической единице;
     0 – соответствует сбросу в состояние логического нуля.
     На системном модуле в момент старта при включении питания и каждом
рестарте ЦП происходит программирование интерфейса КР580ВВ55 следующим
образом: в регистр 177606 записывается двоично-восьмеричный код 202.


         7   6   5   4   3   2   1   0
       --------------------------------- 
       : 1 : 0 : 0 : 0 : 0 : 0 : 1 : 0 :
       --------------------------------- 


     Т.е. выполняются следующие установки:
     - для всех портов выбран режим работы 0;
     - для порта В выбирается режим работы на ввод;
     - для порта А и С режим работы на вывод.
     Эти установки определяют режим работы 8-разрядных системных регистров А,
В, С, каждый из которых поставлен в соответствие порту программируемого
интерфейса.
     Системный регистр А имеет магистральный адрес 177600 и является
8-разрядный регистром, работающим на запись. Формат системного регистра А
приведён на Рис.15.


            7     6     5    4     3    2     1    0
         ----------------------------------------------
177600   :ДПЗУ:ПРД/МАГ:ИНД2:ИНД1:Повер:Двиг:Выбор:НГМД:   Запись
         ----------------------------------------------

                                   Рис.15

     <7> служит для выбора адресов ПЗУ:
     0 – соответствует области адресов ПЗУ от 160000 до 177377;
     1 – записанная в этом разряде, подключает дополнительное ПЗУ с адресами,
соответствующим адресам 6 банка адресного пространство ЦП. Область адресов
ПЗУ ограничивается магистральными Адресами 140000 – 177377.
     <6> - служит для кодирования информации при записи на бытовой кассетный
магнитофон.
     <5,4> - эти разряды служат для управления двумя из трёх светодиодов,
расположены на системном модуле.
     Запись “1” в <5> разряд вызывает зажигание светодиода VD16, а запись “1”
в <4> разряд зажигание VD9.
     Запись “0” в <5> и <4> разряды вызывает гашение светодиодов VD16 и VD9
соответственно.
     <3> служит для выбора поверхности магнитного носителя НГМД.
     “0”, записанный в этом разряде, служит для выбора нижней стороны
носителя.
     “1” выбирает верхнюю поверхность магнитного носителя.
     <2> включения двигателя НГМД.
     Для включения двигателя НГМД в этом разряде должен быть записан “0”.
Для выключения двигателя НГМД в этом разряде должна быть записана “1”.
     <1,0> код, записанный в этих разрядах, определяет номер физического
привода НГМД, подключенный к интерфейсу контроллера НГМД в данный момент
времени. Таблица соответствия состояния разрядов номеру привода НГМД
приведена ниже:


               ----------------------------------
               : <1> : <0> : Номер привода НГМД :
               ----------------------------------
               :  0  :  0  :       0            :
               :  0  :  1  :       1            :
               :  1  :  0  :       2            :
               :  1  :  1  :       3            :
               ----------------------------------


Формат системного регистра В приведён на Рис.16.


           7     6    5    4   3    2    1    0
         -----------------------------------------
177602   :ПРМАГ:ЗАВ:ОБСЛ:РВК1:РВК0:ГТВ:ЗОБМ:ГТВ93:   Чтение
         -----------------------------------------

                                   Рис.16

     <7> служит для чтения кодированной информации с бытового кассетного
магнитофона.
     <6,5> разряды зарезервированы для использования при реализации протокола
обмена по типу ИРПР-М.
     <4,3> разряды используются для считывания информации о выбранном режиме
работы видеоконтроллера в соответствии с Табл.10.

                                                             Таблица 10
            -------------------------------------------
            :  <4>   :  <3>  : Кадровая синхрочастота,:
            : РВК1   : РВК0  :        Гц              :
            -------------------------------------------
            :   0    :   0   :        50              :
            :   0    :   1   :        72              : 
            :   1    :   Х   :        60              : 
            -------------------------------------------


     Информации этих разрядов должна учитываться программами, работающими по
прерыванию от таймера с вектором прерывания 100, т.к. запрос прерывания по
таймеру стробируется импульсом кадрового синхроимпульса.
     <2> служит для считывания состояния сигнала готовности накопителя “ГТВ
Н” интерфейса НГМД. Нулевое значение разряда соответствует готовности НГМД.
Состояние разряда, равное “1”, указывает на то, что накопитель не готов.
     <1> разряд дублирует состояние линии запрос обмена (DRQ) БИС контроллера
НГМД КР1818ВГ93 (БИСК). Состояние логической единицы, считанное из этого
разряда, указывает ЦП на то, что БИСК готов для обмена данными. В режиме
чтения с НГМД: байт данных считан, находится в регистре данных БИСК и готов
для считывания ЦП. В режиме записи на НГМД: БИСК готов для приёма
очередного байта данных с линии “МК00 Н – МК07 Н”. Разряд сбрасывается по
завершении процедуры обмена байтом данных между ЦП и БИСК через линии “МК00 Н
– МК07 Н”.
     <0> разряд дублирует состояние линии готовность БИСК (INTR). Нулевое
состояние этого разряда сигнализирует о готовности БИСК к приёму очередной
команды. “1” в разряде “0” означает, что БИСК загружена командой и находится
в процессе её выполнения.
     Формат системного регистра рС приведён на Рис.17.

          7     6       5      4    3    2    1    0
        ----------------------------------------------
177604  :СИНТ:РАЗР ГР:УПР ГР:ИНД3:РАЗР:ОКЗЛ:ОККР:ОКСН:   Запись
        ----------------------------------------------

                                   Рис.17

     <7> служит для управления программируемым таймером, формирующим сигнал
модуляции для устройства звуковоспроизводящего.
     <6> служит для разрешения или запрещения работы устройства
звуковоспроизводящего.
     “0” запрещает работу;
     “1” разрешает работу звуковоспроизводящего устройства.
     <5> изменение состояния этого разряда позволяет изменять тон звучания
динамика.
     <4> разряд служит для управления одним из трёх светодиодов,
установленных на системном модуле. Установка разряда в состояние “1” -
зажигает светодиод VD17. Сброс разряда в нулевое состояние тушит светодиод
VD17.
     <3> позволяет управлять разрешением ВК.
     “0” соответствует переводу ВК в режим среднего разрешения, при этом ВК
управляет областью экрана монитора 320х200 ЭО.
     “1” соответствует режиму высокого разрешения, ВК управляет областью
640х200 ЭО ЭЛТ.
     <2-0> двойная комбинация этих разрядов служит для выбора цвета
неиспользуемой части экрана монитора (окаймления) из палитры, состоящей из 8
цветов в соответствии с Табл.9.

     4.9. Программируемый таймер

     Программируемый таймер реализован на БИС КР38ВВИ53 и состоит из трёх
независимых 16-разрядных счётчиков (каналов), два из которых служат для
формирования таковых сигналов синхронизации ввода/вывода последовательных
портов, а один используется для управления устройством звуковоспроизводящим
и отсчёта временных интервалов.
     Для выбора режима работы программируемого таймера используется
управляющего слово, записанное в 8-разрядный регистр с магистральным адесом
177506 для чтения и адресом 177526 для записи. Программирование режима
работы каждого из трёх каналов осуществляется индивидуально и в произвольном
порядке путём ввода управляющих слов в регистры режимов каналов, а в счётчики
– запрограммированного числа байт. Управляющее слово определяет режим работы
канала или счёта ( двоичный или двоично-десятичный ), формат чисел (одно- или
двухбайтовый).
     Для обмена данными с каждыми из трёх счётчиков служат регистры, имеющие
следующие магистральные адреса:


           ---------------------------------------------
           : Номер   : Адрес регистра : Адрес регистра :
           : канала  : для чтения     : для записи     :
           ---------------------------------------------
           : Канал 0 :   177500       :    177520      :
           : Канал 1 :   177502       :    177522      :
           : Канал 2 :   177504       :    177524      :
           ---------------------------------------------
           :Упр.слово:   177506       :    177526      :
           ---------------------------------------------


Формат управляющего слова показан на рис.18.

           7    6    5   4   3     2   1    0
         ---------------------------------------
177602   :ВБК1:ВБК0:431:430: Р2 : Р1 : Р0 : С4 :   Чтение
         ---------------------------------------

                                Рис.18

     <7,6> разряды служат для выбора регистра режима соответствующего канала.


           --------------------------------------
           : ВБК1 : ВБК0 : Номер канала таймера :
           --------------------------------------
           :  0   :  0   :         0            :
           :  0   :  1   :         1            :
           :  1   :  Х   :         2            :
           --------------------------------------


     <5,4> разряды используются для выбора характера операции чтения/загрузки
производимой по отношению к счётчикам.


           -----------------------------------------------------
           : ЧЗ1 : ЧЗ0 : Тип операции                          :
           -----------------------------------------------------
           :  0  :  0  : Операция “Защёлкивание”               :
           :  0  :  1  : Чтение/загрузка только младшего байта :
           :  1  :  0  : Чтение/загрузка только старшего байта :
           :  1  :  1  : Чтение/загрузка сначала младшего,     :
           :     :     : затем старшего байта                  :
           -----------------------------------------------------


<3,2,1> служат для выбора одного из режимов работы.

                                                            Таблица 11

--------------------------------------------------------------------------
: <3> : <2> : <1> : Режим работы   :          Описание режима            :
--------------------------------------------------------------------------
:  0  :  0  :  0  :      0         : Прерывание по окончании счёта       :
:  0  :  0  :  1  :      1         : Ждущий мультивибратор               :
:  Х  :  1  :  0  :      2         : Генератор импульсный                :
:  Х  :  1  :  1  :      3         : Генератор меандра                   :
:  1  :  0  :  0  :      4         : Одиночный программно формируемый    :
:     :     :     :                : Стробирующий сигнал                 :
:  1  :  0  :  1  :      5         : Одиночный аппаратно стробирующий    :
:     :     :     :                : Сигнал                              :
--------------------------------------------------------------------------


     <0> выбирает тип счёта:
     0 – двоичный;
     1 – двоично-десятичный.
     Программируемый таймер по включении питания программируется следующим
образом: по адресу управляющего слова 177506 записывается
двоично-восьмеричный код 26, т.е.

          7       6     5     4     3     2     1     0
         -------------------------------------------------
177526   :  0  :  0  :  0  :  1  :  0  :  1  :  1  :  0  :
         -------------------------------------------------


     Канал 0 программируемого таймера переводится в режим 3 (генератор
меандра), операция чтение/загрузка происходит для младшего байта
16-разрядного счётчика, счётчик работает в двоичном режиме.
     После записи управляющего слова в регистр режима выбранного канала и
перевода его в соответствующий режим, происходит загрузка выбранного
счётчика, в нашем случае это число 32. В режиме 3 нулевой канал таймера
работает, как делитель частоты тактирования БИС на N. Для системного модуля
тактовая частота программируемого таймера равна 2 МГц. Следовательно, период
тактирования составляет 0,5 мкс. Счётчик загружен значением N=32 в
восьмеричной системе, что соответствует N=26 в десятичной системе счисления.
Период выходного сигнала счётчика вычисляется по формуле:

                  T_вых = T_такт х N_10

     Выходная частота счётчика 0 и 1 используется для синхронизации порта
клавиатуры и порта печати и соответствует частоте, необходимой для
обеспечения скорости обмена 4800 бод.

     4.10. Интерфейсы внешних устройств

     На системном модуле реализованы три интерфейса для связи с внешними
устройствами:
     - Интерфейс для связи с клавиатурой типа “Электроника МС 7004” (порт
клавиатуры);
     - Интерфейс для подключения устройства последовательного обмена по типу
Стык С2 (порт печати);
     - Интерфейс для подключения устройства, работающего в режиме обмена
данными в параллельном коде (клавиатура “Электроника МС 7007”);
     - Интерфейс для подключения бытового магнитофона.

     4.10.1 Порт клавиатуры предназначен для подключения блока клавиатуры
“Электроника МС 7004” и реализован на БИС КР580ВВ51, представляющей собой
универсальный синхронно-асинзронный программируемый приёмо-передатчик
(УСААП).
     Для задания режима работы, ввода команд, чтения информации о состоянии
порта, а также обмена данными через 8-разрядную магистраль МК00-МК08
используются внутренние регистры УСАПП, к которым можно обратиться по
магистральным адресам в соответствии с Табл.12.

                                                             Таблица 12

------------------------------------------------------------------------
:   Адрес регистра   :   Выполняемая функция     :    Вид доступа      :
------------------------------------------------------------------------
:  177440            : Буфер данных приёмника    :   Чтение            :
:  177460            : Буфер данных передатчика  :   Запись            :
:  177442            : Регистр состояния         :   Чтение            :
:  177442            : Регистры инструкций       :   Запись            :
:                    :                           :                     :
------------------------------------------------------------------------


     Порт клавиатуры готов к выполнению функции обмена только после
программирования, которое состоит в загрузке УСАПП набором управляющих слов,
генерируемых ЦП. Эти слова должны следовать непосредственно после операции
инициализации УСАПП. Процедура инициализации УСАПП может быть аппаратной и
программной. Аппаратная инициализация происходит при каждом старте (рестарте)
ЦП, сигналом высокого уровня, приходящим на 21 вывод БИС.
     Программная инициализация УСАПП производится с целью гарантированного
перевода БИС в режим чтения инструкции команд перед подачей команды “Сброс”.
     Для программной инициализации необходимо последовательно загрузить в
регистр инструкций три байта нулей, а затем подать команду “Сброс”, после
этого УСАПП готов к вводу инструкции режима.
     На Рис.19 условно указана последовательность подачи управляющих слов
программирования порта клавиатуры.


           ----------------------------------
           :       Инициализация            :
           :       команда сброс            :
           ----------------------------------
           :      Инструкция режима         :
           ----------------------------------
           :      Инструкция команд         :
           ----------------------------------
           :                                :
           :          Данные                :
           :                                :
           ----------------------------------
           :      Инструкция команд         :
           ----------------------------------
           :                                :
           :          Данные                :
           :                                :
           ----------------------------------



-----------                                 -----------------
           !Старт !     Данные     : Чет   !Стоп
           ---------------------------------

                                   Рис.19

     Формат инструкции режима приведён на Рис.20.


         7     6       5      4       3     2      1      0
     ----------------------------------------------------------
     :  С2  :  С1  :  Чёт  :  РП  :  Д2  :  Д1  :  В2  :  В1  :
     ----------------------------------------------------------
        1      1       0      0      1      1       1      0

                                Рис.20

     <7,6> Служат для выбора стоповых бит в посылке, обрабатываемой портом
(см. Рис.19). Число стоповых бит определено в соответствии с Табл.13.

                                                            Таблица 13
          -----------------------------------------
          :    С2     :    С1     : Число стоповых:
          :           :           :     бит       :
          -----------------------------------------
          :     0     :     0     : Недопустимо   :
          :     0     :     1     :      1        :
          :     1     :     0     :      1,5      :
          :     1     :     1     :      2        :
          :           :           :               :
          -----------------------------------------

     <5> определяет вид контроля на чётность:
     “1” соответствует выбору контроля на чётность;
     “0” соответствует выбору контроля на нечётность;
     <4> служит для разрешения или запрещения контроля на чётность:
     “1” разрешает;
     “0” запрещает.
     <3,2> определяет длительность посылки данных в соответствии с Табл.14

                                                            Таблица 14
        --------------------------------------------
        :     Д2     :     Д1     :Число бит данных:
        --------------------------------------------
        :     0      :     0      :       5        :
        :     0      :     1      :       6        :
        :     1      :     0      :       7        :
        :     1      :     1      :       8        :
        :            :            :                :
        --------------------------------------------

     <1,0> служат для выбора режима работы УСАПП в соответствии с Табл.15

                                                            Таблица 15
        --------------------------------------------
        :     В2     :     В1     :  Режим работы  :
        --------------------------------------------
        :      0     :     0      : Синхронный     :
        :      0     :     1      :Асинхронный 1/1 :
        :      1     :     0      :Асинхронный 1/16:
        :      1     :     1      :Асинхронный 1/64:
        :            :            :                :
        --------------------------------------------


     Асинхронный режим работы имеет три подрежима, различающихся соотношением
частот общей синхронизации микросхемы и синхронизации ввода/вывода.
     Программирование порта клавиатуры осуществляется в процессе выполнения
системного теста, при этом делаются следующие установки:
     - асинхронный режим 1/16;
     - 8-битный формат посылки данных;
     - 2 стоповых бита;
     - Запрещение контроля на чётность.
     После ввода инструкций режима порт готов к вводу инструкции команд.
Формат инструкции команд приведён на Рис.21.


          7       6       5      4       3        2       1        0
        ----------------------------------------------------------------
        :  СС  : СБР  :  RTS  :  ОСИ  :  ОБР  :   ПРМ  :  DTR  :  ПРД  :
        ----------------------------------------------------------------

                                    Рис.21

     <7> Используется в синхронном режиме и служит для ввода образцов
синхросимволов.
     “1”, записанная в этом разряде, разрешает ввод образцов синхросигналов.
     “0” не оказывает воздействие.
     <6> служит для программной инициализации УСАПП.
     “1”, записанная в этот разряд, производит программный сброс и
возвращает УСАПП в режим чтения инструкции режима.
     “0” не оказывает воздействия.
     <5> позволяет управлять выводом 23 БИС УСАПП.
     “1”, записанная в этот разряд, переводит вывод 23 БИС в состояние
низкого уровня, что соответствует передаче запроса по линии интерфейса связи
о готовности приёмника внешнего устройства принять данные.
     “0” не оказывает воздействия.
     <4> сброс триггеров ошибок в исходное состояние.
     Запись “1” в этот разряд позволяет сбросить разряды <5-3> регистра
состояния в нулевое состояние.
     “0” не оказывает воздействия.
     <3> служит для формирования посылки, дешифруемой приёмником как пауза.
     “1” в этом разряде переводит линию передаваемых данных (вывод 19 УСАПП)
в низкий уровень, соответствующий состоянию логического нуля;
     “0” не оказывает воздействия.
     <2> служит для разрешения приёма данных.
     “1” разрешает приём информации;
     “0” запрещает приём информации.
     <1> служит для управления выводом 24 УСАПП.
     “1”, записанная в разряде, приводит к установке низкого уровня на выводе
24 УСАПП, что соответствует передаче запроса по линии интерфейса о готовности
передатчика внешнего устройства передать данные.
     “0” не оказывает влияния.
     <0> служит для разрешения передачи данных.
     “1” разрешает передачу данных;
     “0” запрещает передачу данных.
     После подачи инструкции команд УСАПП готов к обмену данными. При
передаче данных он осуществляет параллельно-последовательное преобразование
данных, передаваемых МП по линии “МК00-МК08”, и также формирует формат
посылки в соответствии с режимом работы. ЦП может в любой момент
проконтролировать состояние порта клавиатуры, путём чтения регистра
состояния УСАПП, формат которого приведён на Рис.22.


           7       6     5      4       3      2       1       0
        -------------------------------------------------------------
        : DSR  : С/П  : ОФ  :  ОП  :  ОЧ  :  Пуст  :  ГПРД :  ГПРМ  :
        -------------------------------------------------------------

                                   Рис.22

     <7> ”1” указывает на то, что вывод 22 УСАПП (DSR) находится в низком
состоянии. Это соответствует приёму по линии интерфейса сигнала готовности
от внешнего устройства.
     <6> для синхронного режима синхросимвола.
     При асинхронном режиме, единичное состояние этого разряда сигнализирует
об обнаружении УСАПП паузы.
     <5> “1” – ошибка формата посылки.
     Не обнаружен стоповый бит, после посылки установленного числа бит данных.
     <4> “1” – ошибка переполнения.
     Символ принят буферным регистром приёмника до считывания предидущего
символа.
     <3> “1” – ошибка чётности.
     <2> “1” – буферный регистр передатчика пуст.
     <1> - готовность приёмника.
     Установка этого разряда в состояние “1” указывает на то, что УСАПП
содержит символ, готовый для считывания ЦП, при этом вывод 14 УСАПП
устанавливается в состояние логической единицы, что воспринимается процессором
как запрос прерывания от клавиатуры.
     Если в этот момент приоритет прерывания процессора не менее 5, по
окончании выполнения текущей команды ЦП уходит на обслуживание прерывания по
вектору 130.
     <0> - готовность передатчика.
     Единица в этом разряде указывает на то, что буферный регистр передатчика
(БРПРД) пуст и может быть загружен ЦП новым символом. Единичное состояние
этого разряда не является достаточным для установления в состояние логической
единицы вывода 15 УСАПП, так как состояние этого выхода определяется ещё
состоянием 17 УСАПП и <0> разрядом инструкции команд (разрешение
передатчика).

     4.10.2. Порт печати предназначен для подключения печатающего
устройства, работающего в последовательном коде, либо другого устройства,
осуществляющего обмен по протоколу СТЫК С2.
     Порт печати реализован на той же БИС, что и порт клавиатуры, поэтому
порядок программирования УСАПП и формат регистров те же, что и для порта
клавиатуры.
     Для управления портом печати используются регистры, имеющие
магистральные адреса согласно Табл.16.

                                                                Таблица 16
    ---------------------------------------------------------------
     Адреса регистра : Выполняемая функция : Вид доступа
    ---------------------------------------------------------------
      177700         : Буфер данных        :  Чтение
                     : приёмника           :
                     :                     :
      177720         : Буфер данных        :  Запись
                     : передатчика         :
                     :                     :
      177702         : Регистр состояния   :  Чтение
                     :                     :
      177702         : Регистр инструкций  :  Запись
    ---------------------------------------------------------------


     4.10.3. Интерфейс для подключения устройства, работающего в режиме
обмена данными в параллельном коде (в дальнейшем параллельный интерфейс)
предназначен для подключения плёночной пассивной клавиатуры
“Электроника МС 7007” и реализован на БИС КР580ВВ55, особенности архитектуры
которой определяет порядок работы с интерфейсом.
     БИС имеет три 8-разядные шины, именуемые в дальнейшем порты  A, B, C,
обмен информации с портами ведётся через регистры:

        Порт A    177540
        Порт B    177542
        Порт C    177544
    Управляющее   177546
    слово

     Перед началом обмена задаётся режим работы БИС параллельного интерфейса,
формат управляющего слова приведён в п.4.8. (Системные регистры).
     Управляющее слово, записываемое по адресу 177546, определяет выбор
следующего режима работы параллельного интерфейса:
     выбирается режим 0;
     порт A используется для вывода данных;
     порт B, C – для ввода данных.
     Клавиатура “Электроника МС 7007” представляет собой двухмерную матрицу
форматом 8х11. Нажатие любой клавиши приводит к замыканию матрицы в точке,
имеющей вполне определённые координаты X и Y, процедура определения кода
каждой клавиши сводится к вычислению координат замкнутой точки матрицы.
Программа обслуживания клавиатуры, резидентно находящаяся в ПЗУ системного
модуля, предварительно записывает во все разряды порта A нули, при нажатии
любой из клавиш происходит замыкании, приводящее к снижению уровня сигнала,
поступающего на вход компаратора; срабатывание компаратора приводит к
выставлению запроса прерывания по 4 уровня от клавиатуры
“Электроника МС 7007”.
     Если текущий приоритет УП не ниже 4, то по завершении выполнения
текущей команды происходит обращение по вектору 60, в котором считывается
адрес программы обслуживания клавиатуры.  Эта программа построена на
принципе сканирования матрицы методом последовательной записи нулей в каждый
разряд порта А и последующей проверки появления нуля в том или ином разряде
портов B и C. Результатом выполнения этой программы является получение
координаты замкнутой точки матрицы, из таблицы кодов может выбран код
нажатой клавиши. Этот же параллельный интерфейс может быть использован для
реализации обмена по протоколу ИРПР.

     4.11. Контроллер НГМД предназначен для управления процедурой обмена
данными между ЦП и двумя накопителями на гибких магнитных дисках, каждый из
которых позволяет работать с двумя поверхностями дискеты диаметром 133 мм.
     Программа обслуживания контроллера НГМД находится в ПЗУ и построена так,
что две поверхности дискеты рассматриваются как разные устройства. Выбор
того или иного устройства производится в соответствии с таблицей 17.

                                                                 Таблица 17

    ----------------------------------------------------------------
    :Логическое имя  : Физический адрес    :  Поверхность дискеты  :
    : устройства     :   устройства        :                       :
    ----------------------------------------------------------------
    :    DZ0         :         0           :     Нижняя            :
    :    DZ1         :         1           :     Нижняя            :
    :    DZ2         :         0           :     Верхняя           :
    :    DZ3         :         1           :     Верхняя           :
    :                :                     :                       :
    ----------------------------------------------------------------


     Блок-схема контроллера НГМД приведена на Рис.23.

    /\
   /  \
  /    \
  -!  !-           -------------        ----------          -----------
   !  !     1МГц   !           ! ИМП ЧТ !        !     ЧТ   !         !
   !  !   -------->!           !<-------!  ФАПЧ  !<---------!         !
   !  !            !           ! Такт   !        !          !Интерфейс!
   !МК! /--------\ !           !<-------!        !          !для связи!
   !00!/ МК00-МК08\!           !        ----------          !с НГМД   !
   !. !\          /!           !                            !         !
   !. ! \--------/ !           !                            !         !
   !. !            !   БИС     !        ----------          !         !
   !15!     ДЧТ    !           !        !        !          !         !
   !  !  --------->!           !------->!  Схема !  ЗАП     !         !
   !  !     ДЭП    !           !ИМПЭП   !предком-!--------->!         !
   !  !  --------->!           !------->!пенсации!          !         !
   !  !            !           !        !        !          !         !
   !  !     ------>!           !        !        !          !         !
  -!  !-    !      !           !        !        !          !         !
  \    /    !      -------------        ----------          !         !
   \  /     !                                               !         !
    \/      ------------------------------------------------!         !
                                                            -----------

                                     Рис.23

     Как видно из блок-схемы; приведённой на Рис.23, контроллер НГМД
состоит из следующих функциональных блок:
     - БИС контроллера (БИСК)
     - схема фазовой автоподстройки частоты (ФАПЧ),
     - схема предкомпенсации записи,
     - интерфейс для связи с НГМД.
     Основным элементом контроллера НГМД является БИСК, в качестве которой
используется микросхема КР1818ВГ93.  БИСК обеспечивает программирование
номера номера дорожки, номера сектора, номера стороны, длины сектора, режима
поиска дорожки установки магнитной головки, режимов чтения и записи
информации, скорости перемещения магнитной головки (МГ).  Кроме того, БИСК
обеспечивает автоматический контроль считываемой и записываемой информации по
контрольному циклическому коду (КЦК), записанному в конце индексного или
информационного массива. БИСК обеспечивает выдачу сигналов предкомпенсации.
     Контроллер позволяет осуществлять запись информации с модифицированной
частотой модуляции (МЧМ).
     При МЧМ кодировании “единица” кодируется импульсом в середине цифровой
позиции (окна).  Тактовый импульс записывается на границе двух окон только в
том случае, если оба они содержат “нуль”.  Если на запись поступают
непрерывно “единицы” или “нули”, то кодирующие импульсы следуют с интервалом
1Т, где Т состовляет 4 мкс. Переходу от “1” к “0” и наоборот соответствует
интервал между импульсами 1,5Т.  И, наконец, последовательности данных “101”
соответствует интервал 2Т.  По этой причине метод кодирования МЧМ называют
трёхчастотным методом кодирования. На Рис.24 показан пример формирования
временных интервалов при кодировании методом МЧМ числа 323 в
двоично-восьмеричном коде.


1	 1        0        1        0        0        1        1
!        !        !        !        !        !        !        !
!        !        !        !        !        !        !        !
!  ---   !  ---   !        !  ---   !        ---      !    --- !    ---
!  ! !   !  ! !   !        !  ! !   !        ! !      !    ! ! !    ! !
!  ! !   !  ! !   !        !  ! !   !        ! !      !    ! ! !    ! !
!--  -------- ----------------- -------------- ------------- -------- --
!  !    1Т  !      2Т        !  1,5Т       !    1,5Т     !  1Т    !
!  !<------>!<-------------->!<----------->!<----------->!<------>!

                                  Рис.24

     Для работы с БИСК имеется набор регистров, имеющих следующие
магистральные адреса:
     177640 регистр состояния (при чтении)
     177640 регистр команд (при чтении)
     177642 регистр дорожки
     177644 регистр сектора
     177646 регистр данных

     Схема ФАПЧ служит для отслеживания фазовых отклонений данных,
принимаемых от НГМД, и выработки сигнала синхронизации для БИСК, позволяющего
безошибочно детектировать эти данные. В контроллере применена схема
цифрового инерционного ФАПЧ.
```

## Приложение 1
```
            Таблица распределения адресов регистров

-------------------------------------------------------------------------------
Адрес регистра!Вид доступа!  Наименование регистра  !Принадлежность регистра
              !           !                         !     устройству
-------------------------------------------------------------------------------
              !           !                         !
177400-177437 ! Запись    ! Регистр расширения ОЗУ  !
-------------------------------------------------------------------------------
177440        ! Чтение    !                         ! Последовательный
--------------------------! Регистр данных КЛ       ! интерфейс для связи с
177460        ! Запись    !                         ! клавиатурой
----------------------------------------------------! “Электроника МС 7004”
177442        ! Чтение    ! Регистр состояния КЛ    !
----------------------------------------------------!
177462        ! Запись    ! Регистр управления КЛ   !
-------------------------------------------------------------------------------
177500        !Определ.   !Регистр скорости обмена КЛ
177502        !регистром  !Регистр скорости обмена ПЧ    Программируемый
177504        !упр. тайм  !Регистр управления ДИН   !
----------------------------------------------------!      таймер
177506        ! Чт./Зап.  !Регистр управления таймера
-------------------------------------------------------------------------------
177540        !Определ.   !Регистр порта A          ! Параллейный интерфейс
177542        !регистром  !Регистр порта B          ! для связи с клавиатурой
177544        !упр. ИРПР  !Регистр порта C          ! “Электроника МС 7004”
или
----------------------------------------------------! обмена по протоколу
177546        ! Чт./Зап.  !Регистр управления ИРПР  ! ИРПР
-------------------------------------------------------------------------------
177600        !Определ.   !Системный регистр A      !
177602        !регистром  !Системный регистр B      !Параллейный интерфейс,
177604        !упр.сист.  !Системный регистр C      !реализующий системные
----------------------------------------------------!    регистры
177606        ! Чт./Зап.  !Системный регистр управл.!
-------------------------------------------------------------------------------
              ! Чтение    !Регистр состояния НГМД   !
177640        !-------------------------------------!
              ! Запись    !Регистр команд НГМД      !    Контроллер
----------------------------------------------------!
177642        ! Чт./Зап.  !Регистр дорожки          !     НГМД
177644        ! Чт./Зап.  !Регистр сектора          !
177646        ! Чт./Зап.  !Регистр данных           !
-------------------------------------------------------------------------------
177700        ! Чтение    !                         !
--------------------------! Регистр данных ПЧ       !Последовательный интерфейс
177720        ! Запись    !                         !реализующий обмен по
----------------------------------------------------!протоколу Стык С2
177702        ! Чтение    !Регистр состояния ПЧ     !
----------------------------------------------------!
177722        ! Запись    !Регистр управления ПЧ    !
------------------------------------------------------------------------------
177770        ! Чт./Зап.  !Адрес обслуживания       !
              !           !останова и системного    !
              !           !таймера                  !
------------------------------------------------------------------------------
```
